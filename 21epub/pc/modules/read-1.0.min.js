epub.def(function(){epub["import"]("epub.modules.tmpl@1.0");$.fn.autoMiddle=function(){var d=$(".read-area");var b=$(".read-area").find("img");var c=b.data("_read_area_img_rate");
if(c!=-1){if(!c){c=b.height()/b.width();b.data("_read_area_img_rate",c);}if(b.attr("width")!="100%"){b.attr("width","100%");}b.attr("height",c*b.width()+"px");
}return this.each(function(){var e=($(this).parent().height()-$(this).height())/2;if(e<0){e=0;}$(this).css({"margin-top":e});});};function a(b){var d=$(".read-area");
var c=$(".read-area").find("img");if(b){c.data("_read_area_img_rate",null);}else{c.data("_read_area_img_rate",-1);}c.attr("width","");c.attr("height","");
}$.read=function(f){var h=f.url||"../../../../data/ca_read.json?page=";var t=f.template||["{{each(i, name) results}}",'<li data-img="${img}"><a href="javascript:void(0);"><img src="${thumb_img}"></a></li>',"{{/each}}"].join("");
var p=$(".content-area");var g=$(".thumbs>ul");var w=g.attr("data-totalPages")||5;var l=1;var e=null;var j=true;var v=$(".prev");var r=$(".next");var i=0;
function s(){var x=g.find("li.active");var y=x.parent().children();return y.index(x);}var q=[];g.find("li").each(function(){var x=$(this);var y=x.attr("data-img");
q.push(y);});var m=false;var k=true;function n(){if(q.length>0){if(m){setTimeout(function(){n();},1000);}else{m=true;var y=q.shift();var x=new Image();
x.onerror=x.onload=function(){if(k){var A=$(g.find("li")[0]);var C=A.attr("data-img");$(".loading").show();$(".read-area").hide();var B=new Image();var z=p.find("img");
B.onload=function(){a();z.attr("src",C);$(".loading").hide();$(".read-area").fadeIn();$(".read-area").autoMiddle();};B.src=C;}m=false;n();k=false;};x.src=y;
}}}v.click(function(){if(i==0){}else{i=i-1;g.trigger("click.li",$(g.find("li")[i]));}});r.click(function(){var x=g.find("li").length;if(i==x-1){u();}else{i=i+1;
g.trigger("click.li",$(g.find("li")[i]));}});function u(){var x=l+1;if(x>w){}else{j=false;var y=h+x;$.ajax({dataType:"json",type:"GET",url:y,success:function(A,B,z){var A=A;
$(A.results).each(function(D,E){var C=E;var F=C.img;q.push(F);n();});$.tmpl(t,A).appendTo(g);$(".nano").nanoScroller();l=x;j=true;setTimeout(function(){u();
},100);},error:function(){}});}}$(".nano").nanoScroller();$(".nano .pane").css({visibility:"hidden"});$(".nano").hover(function(){if(j){$(this).children(".pane").css({visibility:"visible"});
}},function(){$(this).children(".pane").css({visibility:"hidden"});});$(".nano").debounce("scrollend",function(x){u();},100);var c="li";g.delegate(c,"click",function(x){g.trigger("click.li",$(this));
});g.bind("click.li",function(z,y){if(!y){return;}var x=$(y);if(x.hasClass("active")){}else{x.addClass("active").siblings().removeClass("active");}i=x.parent().children("li").index(y);
d();});function d(y){$(".loading").show();$(".read-area").hide();var y=$(g.find("li")[i]);var A=$(y.find("img")).attr("src");var B=y.attr("data-img");var x=p.find("img");
a(true);x.attr("src",A);$(".read-area").autoMiddle();$(".loading").hide();$(".read-area").fadeIn();var z=new Image();z.onload=function(){if(s){a();}x.attr("src",B);
$(".read-area").autoMiddle();};z.src=B;b(y);}function b(y){var B=y.offset().top;var x=y.height();var z=$(".slider").css("top");z=z.replace("px","");z=parseFloat(z,10);
var A=$(".thumbs").css("paddingTop").replace("px","");if($(window).height()<=B+x){$(".nano").nanoScroller({scrollTop:B+$(".content").scrollTop()-$(".topbar").height()-A});
}if(B<$(".topbar").height()){$(".nano").nanoScroller({scrollTop:B+$(".content").scrollTop()-$(".topbar").height()-A});}$(".pages").html((i+1)+"/"+w);}function o(){var y=$(g.find("li")[0]);
var z=$(y.find("img")).attr("src");var x=p.find("img");x.attr("src",z);$(".loading").hide();$(".read-area").fadeIn();$(".read-area").autoMiddle();b(y);
$(window).resize(function(){$(".read-area").autoMiddle();});}o();n();u();};});