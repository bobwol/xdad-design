var AnnotationManager=function(ad,ae,aJ){var aQ=this;var ac=function(){aS=new CommentPanel(ad,ae);aE();aQ.scale();};var ab="",az="";this.deactivateAllModes=function(){$(ab).die("mousedown",av).die("mousedown",ax).die("mousedown",ag).die("mousedown",aj).die("mousedown",at).die("mousedown",af);
$(az).die("mouseup",ar).die("mouseup",al);aU(aK.ANNOTATING);ap();};this.activateAnnotationMode=function(a){this.deactivateAllModes();console.log(2);ap();
switch(a){case DocViewer.HIGHLIGHT_MODE:aN(ar,false);aG(at,".layer.highlight,.layer.anno,.layer.text,.layer.commentline");break;case DocViewer.STRIKEOUT_MODE:aN(al,false);
aG(af,".layer.highlight,.layer.anno,.layer.text,.layer.commentline");break;case DocViewer.ANCHOR_MODE:am(aK.ANNOTATING);aG(aj);break;case DocViewer.AREA_MODE:am(aK.ANNOTATING);
aG(ax);break;case DocViewer.TEXT_COMMENT_MODE:aN(ar,true);aG(at,".layer.highlight,.layer.anno,.layer.text,.layer.commentline");break;case DocViewer.DRAW_MODE:am(aK.ANNOTATING);
aG(ag);break;case DocViewer.TEXTBOX_MODE:am(aK.ANNOTATING);aG(av);break;default:break;}};this.renderAnnotation=function(a){switch(a.type){case AnnoTypes.DRAWING:aP(a.id,a.pageNumber,a.x,a.y,a.lines,a.color,a.author,false);
break;case AnnoTypes.AREA:X(a.id,a.pageNumber,a.x,a.y,a.width,a.height,a.author,false);break;case AnnoTypes.ANCHOR:ah(a.id,a.pageNumber,a.x,a.y,a.author);
break;case AnnoTypes.TEXTBOX:var b=aI(a.id,a.content,a.x,a.y,a.pageNumber,a.color,a.size,a.bgColor,a.author);break;case AnnoTypes.HIGHLIGHT:var c=aA(a.id,a.content,a.pageNumber,a.x,a.y,a.color,a.author,JSON.parse(a.rectangles));
c.relatedAnnotation=a.relatedAnnotation;break;}};this.clearAnnotation=function(a){an(a.id);};this.getAnnotation=function(a){return aw[a];};this.addReplacementText=function(a){aR(aw[a.id]);
};this.attachComment=function(a){aS.renderComment(null,aw[a.id],"",0,ay.authorId,ay.name,true);};this.renderComment=function(b,c){var a=aM[b.author]?aM[b.author].name:null;
var d=aw[b.annoId];if(d){aS.renderComment(b.id,d,b.content,b.orderIndex,b.author,a,false,false,c);}};this.updateCommentPositions=function(){aS.updatePositions();
};this.clearCommentReply=function(a){aS.clearCommentReply(a);};this.toggleCommentPanel=function(){aS.toggle();};this.setActiveAuthorInfo=function(a){ay=a;
aS.setActiveAuthorInfo(a);};this.setKnownAuthors=function(a){aM=a;};this.updateAuthor=function(a){aS.updateAuthor(a);};this.scale=function(){ap();$(".layer.anno").each(function(b){var a=$(this).closest(".page-outer").find(".page");
$(this).width(a.width());});$(".layer.highlight").each(function(b){var a=$(this).closest(".page-outer").find(".page");$(this).width(a.width());});$(".layer.strikeout").each(function(b){var a=$(this).closest(".page-outer").find(".page");
$(this).width(a.width());});$.each(aw,function(a,b){b.scale();});aS.scale();};this.endCurrentDrawing=function(){ap();};this.defocusActiveAnnotation=function(f,e,b,g,c,d){if(AnnotationManager.activeAnnotation){var a=AnnotationManager.activeAnnotation.type;
if(e&&a==AnnoTypes.TEXTBOX){AnnotationManager.activeAnnotation.defocus(f);return true;}else{if(b&&a==AnnoTypes.DRAWING){AnnotationManager.activeAnnotation.defocus(f);
return true;}else{if(g&&a==AnnoTypes.ANCHOR){AnnotationManager.activeAnnotation.defocus(f);return true;}else{if(c&&a==AnnoTypes.AREA){AnnotationManager.activeAnnotation.defocus(f);
return true;}else{if(d&&a==AnnoTypes.HIGHLIGHT){AnnotationManager.activeAnnotation.defocus(f);return true;}}}}}}return false;};this.defocusActiveComment=function(){return aS.defocusActiveComment();
};this.updateVisibleAuthors=function(c){for(var a in aw){var b=aw[a];if($.inArray(b.author,c)!==-1){b.show();}else{b.hide();}}aS.handleCheckedAuthorListChange(c);
};this.setHighlightColor=function(a,b){if(b){var c=aw[b.id];c.setColor(a);}else{if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation.types==AnnoTypes.HIGHLIGHT){AnnotationManager.activeAnnotation.setColor(a);
}}};this.setDrawingColor=function(b,c){if(c){var a=aw[c.id];a.setColor(b);}else{if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation.type==AnnoTypes.DRAWING){AnnotationManager.activeAnnotation.setColor(b);
}}ap();};this.setTextboxColor=function(a,b){if(b){var c=aw[b.id];c.setColor(a);}else{if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation.type==AnnoTypes.TEXTBOX){AnnotationManager.activeAnnotation.setColor(a);
}}};this.setTextboxSize=function(a){if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation.type==AnnoTypes.TEXTBOX){AnnotationManager.activeAnnotation.setSize(a);
}};this.setTextboxBGColor=function(a){if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation.type==AnnoTypes.TEXTBOX){AnnotationManager.activeAnnotation.setBGColor(a);
}};this.createHighlight=function(a,b){ao(a,b);};this.createStrikeout=function(a){ao(a,false,true);};this.getIsReadOnly=function(a){return ae||((ay&&ay.authorId!=a)&&!ad);
};var ai={},aw={};var aT={};var aM={};var aS=null;var ay;var aq=null;var aF=null;var aE=function(){$(aS).bind({commentUpdated:function(a,b){b.annoId=b.comment.annotation.id;
b.annoType=b.comment.annotation.type;b.author=b.authorId;var c=CommentInfo.makeFromObject(b);$(aQ).trigger("commentUpdated",[c]);},commentDeleted:function(b,a){$(aQ).trigger("commentDeleted",[a]);
},visibilityChanged:function(a){$(aQ).trigger("commentPanelVisibilityChanged",[a]);},commentFocused:function(a,b){}});};var an=function(a){var e=aw[a];
if(e){if(e.type==AnnoTypes.DRAWING&&e==au){ap();}if(e.type==AnnoTypes.HIGHLIGHT){var f=Y(e.pageNumber);for(var d=0;d<e.rectangles.length;++d){var c=e.rectangles[d];
f.remove({x:c.x+1,y:c.y+1,w:1,h:1},c.id);}if(e.relatedAnnotation!=""){an(e.relatedAnnotation);}HighlightUtilities.clearSelection();}if(e.type==AnnoTypes.TEXTBOX){for(var a in aw){var b=aw[a];
if(b.relatedAnnotation==e.id){b.relatedAnnotation="";var g=HighlightInfo.makeFromObject(b);$(aQ).trigger("annotationUpdated",[g]);}}}aQ.defocusActiveAnnotation(true,true,true,true,true,true);
e.destroy();delete aw[a];if(e.comment){aH(e.comment.id);}$(aQ).trigger("annotationDeleted",[a]);}};var aH=function(a){aS.destroyComment(a);};var aB=function(a,b){aS.focusComment(a,b);
};var au=null;var ag=function(c){if(c.button!=2){if(aQ.defocusActiveAnnotation(true,true,true,true,true,true)){return;}if(aQ.defocusActiveComment()){return;
}var e=$(c.target).closest(".page-outer");var a=e.offset();var f=parseInt(e.attr("pagenum"))+1;var b=(c.pageX-a.left)/DocumentManager.DRAWSCALE;var d=(c.pageY-a.top)/DocumentManager.DRAWSCALE;
if(au&&au.pageNumber==f){au.addLine(b,d);}else{var g=aP(null,f,b,d,"[]",aJ.newDrawColor,ay.authorId,true);au=g;}}};var aP=function(d,i,f,g,e,c,j,a){var h=aw[d];
if(h){h.toggleUpdates(false);h.setLines(e);h.setPosition(f,g);h.setColor(c);h.toggleUpdates(true);}else{var b=aQ.getIsReadOnly(j);h=new Drawing(d,ak(i),i,f,g,e,c,j,b,a);
aw[h.id]=h;if(!b){$(h).bind({annotationUpdated:function(m){var k=m.target;var l=DrawingInfo.makeFromObject(k);$(aQ).trigger("annotationUpdated",[l]);},dragStarted:function(k){ap();
am(aK.DRAGGING);},dragStopped:function(k){aU(aK.DRAGGING);},drawStarted:function(k){am(aK.DRAGGING);},drawStopped:function(k,l){aU(aK.DRAGGING);if(!l){ap();
}},annotationContextMenu:function(m,k){var l=DrawingInfo.makeFromObject(k.annotation);k.annotation=l;$(aQ).trigger("annotationContextMenu",[k]);},focused:function(k){var l=k.target;
aJ.setDrawingMode(l.color,true);},defocused:function(k){aJ.setCurrentMode(Toolbar.LAST_CURRENT_MODE);},deleteRequested:function(k){an(k.target.id);}});
}}return h;};var ap=function(){if(au){au.endDrawing();}au=null;};var aj=function(h){if(aQ.defocusActiveAnnotation(true,true,true,true,true,true)){return;
}if(aQ.defocusActiveComment()){return;}var g=$(h.target).closest(".page-outer");var i=g.find(".layer.anno");var b=g.offset();var f=parseInt(g.attr("pagenum"))+1;
var c=(h.pageX-b.left)/DocumentManager.DRAWSCALE;var d=(h.pageY-b.top)/DocumentManager.DRAWSCALE;var a=ah(null,f,c,d,ay.authorId);var e=AnchorInfo.makeFromObject(a);
$(aQ).trigger("annotationUpdated",[e]);setTimeout(function(){a.focus(true);},0);};var ah=function(a,e,g,b,d){var f=aw[a];if(f){f.setPosition(g,b);aS.annotationUpdated(f);
}else{var c=aQ.getIsReadOnly(d);f=new Anchor(a,ak(e),e,g,b,d,c);aw[f.id]=f;if(!c){$(f).bind({annotationUpdated:function(h){var i=h.target;var j=AnchorInfo.makeFromObject(i);
$(aQ).trigger("annotationUpdated",[j]);aS.annotationUpdated(i);},dragStarted:function(h){am(aK.DRAGGING);},dragStopped:function(h){aU(aK.DRAGGING);},annotationContextMenu:function(h,i){var j=AnchorInfo.makeFromObject(i.annotation);
i.annotation=j;$(aQ).trigger("annotationContextMenu",[i]);},focused:function(i){aJ.setAnchorMode(true);var h=i.target.comment;if(h){aB(h,false);}else{aS.renderComment(null,i.target,"",0,ay.authorId,ay.name,true);
}},defocused:function(i){aJ.setCurrentMode(Toolbar.LAST_CURRENT_MODE);var h=i.target.comment;if(h){h.defocus();}},deleteRequested:function(h){an(h.target.id);
}});}}return f;};var ax=function(d){if(d.button!=2){if(aQ.defocusActiveAnnotation(true,true,true,true,true,true)){return;}if(aQ.defocusActiveComment()){return;
}var e=$(d.target).closest(".page-outer");var a=e.offset();var f=parseInt(e.attr("pagenum"))+1;var b=(d.pageX-a.left)/DocumentManager.DRAWSCALE;var c=(d.pageY-a.top)/DocumentManager.DRAWSCALE;
X(null,f,b,c,0,0,ay.authorId,true);}};var X=function(c,h,f,g,b,e,i,j){var d=aw[c];if(d){d.setPositionAndDimensions(f,g,b,e);aS.annotationUpdated(d);}else{var a=aQ.getIsReadOnly(i);
d=new Area(c,ak(h),h,f,g,b,e,i,a,j);aw[d.id]=d;if(!a){$(d).bind({annotationUpdated:function(m){var k=m.target;var l=AreaInfo.makeFromObject(k);$(aQ).trigger("annotationUpdated",[l]);
aS.annotationUpdated(k);},dragStarted:function(k){am(aK.DRAGGING);},dragStopped:function(k){aU(aK.DRAGGING);},annotationContextMenu:function(m,k){var l=AreaInfo.makeFromObject(k.annotation);
k.annotation=l;$(aQ).trigger("annotationContextMenu",[k]);},focused:function(l){aJ.setAreaMode(true);var k=l.target.comment;if(k){aB(k,false);}else{aS.renderComment(null,l.target,"",0,ay.authorId,ay.name,true);
}},defocused:function(l){aJ.setCurrentMode(Toolbar.LAST_CURRENT_MODE);var k=l.target.comment;if(k){k.defocus();}},deleteRequested:function(k){an(k.target.id);
}});}}return d;};var av=function(a){if(aQ.defocusActiveAnnotation(true,true,true,true,true,true)){return;}if(aQ.defocusActiveComment()){return;}aa(a);};
var aa=function(m){var l=$(m.target).closest(".page-outer");var k=parseInt(l.attr("pagenum"))+1;var b=m.pageX;var c=m.pageY;var q=l.offset();b=(b-q.left);
c=(c-q.top);var j=16;var d=2;var n=5;var a=$('<div class="textbox normal"><div class="textbox-inner"></div></div>').appendTo($(".layer.anno").eq(0));a.css({fontSize:aJ.newTextSize*DocumentManager.DRAWSCALE});
var o=a.outerHeight()-(j/2)-(DocumentManager.DRAWSCALE*d);var f=DocumentManager.DRAWSCALE*n;var p=c-o;var e=b-n;var g=e/DocumentManager.DRAWSCALE;var h=p/DocumentManager.DRAWSCALE;
a.remove();var i=aI(null,"",g,h,k,aJ.newTextColor,aJ.newTextSize,aJ.newTextBGColor,ay.authorId);setTimeout(function(){i.focus(true,true);},0);};var aI=function(d,a,f,h,j,c,e,g,k){var i=aw[d];
if(i){i.toggleUpdates(false);i.setContent(a);i.setColor(c);i.setPosition(f,h);i.setSize(e);i.setBGColor(g);i.toggleUpdates(true);}else{var b=aQ.getIsReadOnly(k);
i=new Textbox(d,aC(j),a,f,h,j,c,e,g,k,b);aw[i.id]=i;if(!b){$(i).bind({annotationUpdated:function(m){var n=m.target;var l=TextboxInfo.makeFromObject(n);
$(aQ).trigger("annotationUpdated",[l]);},deleteRequested:function(l){an(this.id);},dragStarted:function(l){am(aK.DRAGGING);},dragStopped:function(l){aU(aK.DRAGGING);
},annotationContextMenu:function(m,n){var l=TextboxInfo.makeFromObject(n.annotation);n.annotation=l;$(aQ).trigger("annotationContextMenu",[n]);},focused:function(m){var l=m.target;
aJ.setTextboxMode(l.color,l.size,l.bgColor,true);},defocused:function(l){aJ.setCurrentMode(Toolbar.LAST_CURRENT_MODE);}});}}return i;};var aO=null;var ar=function(b,d){if(b.button!=2){var a=HighlightUtilities.getSelectionRange();
var c=b.data.customData;if(a){ao(a,c,d);}b.stopPropagation();b.preventDefault();}};var at=function(a,b){if(aQ.defocusActiveAnnotation(true,true,true,true,true,true)){return;
}if(aQ.defocusActiveComment()){return;}};var Z=function(a){var b=true;if(a.length>2000){b=confirm("Are you sure you want to select this much text?");}return b;
};var ao=function(c,k,g){var h=HighlightUtilities.getRangeStartPage(c);var i=HighlightUtilities.getHLRangeContent(c);if(!Z(i)){HighlightUtilities.clearSelection();
return;}var j=h.offset();var f=parseInt(h.attr("pagenum"))+1;var b=HighlightUtilities.getRectanglesFromSelection(c);if(b!=null){var a=g?0:aJ.newHighlightColor;
var d=aA(null,i,f,b.x,b.y,a,ay.authorId,b.rectangles);if(k){aS.renderComment(null,d,"",0,ay.authorId,ay.name,true);}if(g){aR(d);}var e=HighlightInfo.makeFromObject(d);
$(aQ).trigger("annotationUpdated",[e]);}};var aR=function(a){if(a.relatedAnnotation==""){var c=aI(null,"",a.x,a.y-15,a.pageNumber,16711698,8,0,ay.authorId);
var b=TextboxInfo.makeFromObject(c);$(aQ).trigger("annotationUpdated",[b]);a.addRelatedAnnotation(c);setTimeout(function(){c.focus(true,false);},0);}else{var c=aw[a.relatedAnnotation];
c.focus(true,false);}};var aA=function(d,i,g,e,f,a,h,k){var c=aw[d];if(c){}else{var j=aQ.getIsReadOnly(h);c=new Highlight(d,$("#page"+(parseInt(g)-1)).find(".layer.highlight"),i,e,f,g,a,h,j,k);
var b=Y(g);for(var l=0;l<k.length;++l){b.insert({x:k[l].x,y:k[l].y,w:k[l].width,h:k[l].height},c.id);}aw[c.id]=c;if(!j){$(c).bind({annotationUpdated:function(m){var n=m.target;
var o=HighlightInfo.makeFromObject(n);$(aQ).trigger("annotationUpdated",[o]);},annotationContextMenu:function(m,n){var o=HighlightInfo.makeFromObject(n.annotation);
n.annotation=o;$(aQ).trigger("annotationContextMenu",[n]);},deleteRequested:function(m){an(m.target.id);}});}}return c;};var al=function(a){ar(a,true);
};var af=function(a){at(a,true);};var aC=function(a){var b=$("#page"+(parseInt(a)-1)).find(".layer.anno");return b.length>0?b:null;};var Y=function(a){var b=null;
if(aT[a]){b=aT[a];}else{b=new RTree();aT[a]=b;aD(a);}return b;};var ak=function(a){var c=null;if(ai[a]){c=ai[a];}else{var b=aC(a);if(b){c=Raphael(b.get(0),"100%","100%");
ai[a]=c;}}return c;};var aL=function(h){var g=$(h.target).closest(".page-outer");var f=parseInt(g.attr("pagenum"))+1;var j=g.offset();var a=(h.pageX-j.left)/DocumentManager.DRAWSCALE;
var b=(h.pageY-j.top)/DocumentManager.DRAWSCALE;var e=Y(f).search({x:a,y:b,w:1,h:1});var d=[];for(var i=0;i<e.length;++i){var c=aw[e[i]];if(c&&c.isVisible()){d.push(aw[e[i]]);
}}return d;};var aD=function(a){$("#page"+(parseInt(a)-1)).live("mousemove",function(b){if(!AnnotationManager.isDragging){var c=aL(b);if(aO&&aO==c[0]){return;
}if(aO&&!aO.isReadOnly){aO.setHover(false);aO=null;}if(c.length>0&&typeof(c[0])!=="undefined"&&!c[0].isReadOnly){c[0].setHover(true);aO=c[0];}}});$("#page"+(parseInt(a)-1)).live("contextmenu",function(b){var c=aL(b);
if(c.length>0&&!c[0].isReadOnly){b.stopPropagation();return false;}});$("#page"+(parseInt(a)-1)).live("mouseup",function(b){if(b.isPropagationStopped()){return;
}var c=aL(b);if(c.length>0&&!c[0].isReadOnly){c[0].showContextMenu(b.pageX,b.pageY);b.stopPropagation();return false;}});};var aG=function(b,a){if($.browser.msie){ab=".page, .layer.anno";
$(".page, .layer.anno").live("mousedown",b);}else{ab=a||".layer.anno";$(ab).live("mousedown",b);}};var aN=function(a,b){az=".page-outer";$(az).live("mouseup",{customData:b},a);
};var aK={ANNOTATING:1,DRAGGING:2};var am=function(a){if(!AnnotationManager.isAnnotating&&!AnnotationManager.isDragging){$("#Doc").addClass("annotating");
if($.browser.msie){aF=$("#Doc")[0].onselectstart;$("#Doc")[0].onselectstart=function(){return false;};aq=$("#Doc")[0].ondragstart;$("#Doc")[0].ondragstart=function(){return false;
};}}if(a==aK.ANNOTATING){AnnotationManager.isAnnotating=true;}if(a==aK.DRAGGING){AnnotationManager.isDragging=true;}};var aU=function(a){if(a==aK.ANNOTATING){AnnotationManager.isAnnotating=false;
}if(a==aK.DRAGGING){AnnotationManager.isDragging=false;}if(!AnnotationManager.isAnnotating&&!AnnotationManager.isDragging){$("#Doc").removeClass("annotating");
if($.browser.msie){$("#Doc")[0].onselectstart=aF;aF=null;$("#Doc")[0].ondragstart=aq;aq=null;}}};ac();};AnnotationManager.activeAnnotation=null;AnnotationManager.activeComment=null;
AnnotationManager.isAnnotating=false;AnnotationManager.isDragging=false;var CommentPanel=function(S,U){var W=this;var M=function(){J();};this.show=function(){if(!$("#Doc").hasClass("hide-comment-panel")){return;
}$("#Doc").removeClass("hide-comment-panel");ac();$(W).trigger("visibilityChanged",[true]);};this.hide=function(){if($("#Doc").hasClass("hide-comment-panel")){return;
}$("#Doc").addClass("hide-comment-panel");$(W).trigger("visibilityChanged",[false]);};this.toggle=function(){if($(".comment-pane").is(":visible")){this.hide();
}else{this.show();}};this.renderComment=function(e,c,g,a,h,d,f,b){ag(e,c,g,a,h,d,f,b);};this.updatePositions=function(){aa();var a=P(false);R(false,a);
};this.clearComment=function(a){Y(a);};this.focusComment=function(e,d,b){$("#DocHolder").scrollLeft(10000000);if(al(e)){var c=P(true,e.annotation.pageNumber);
aa();R(true,c);var a=$("#page"+(parseInt(e.annotation.pageNumber)-1)).find(".comment-pane .overflow-close-button");a.show();T=true;}e.focusReply(b);};this.defocusActiveComment=function(){if(AnnotationManager.activeComment){AnnotationManager.activeComment.defocus(true);
return true;}return false;};this.destroyComment=function(a){var b=af[a];if(b){X(b);b.destroy();b.annotation.comment=null;aa();var c=P(false,b.annotation.pageNumber);
R(false,c);delete af[a];}if(ad.length==0){W.hide();}};this.clearCommentReply=function(a){O(a);};this.annotationUpdated=function(c){var a=c.comment;if(a){aj(a);
aa();var b=P(false,a.annotation.pageNumber);R(false,b);}};this.setActiveAuthorInfo=function(a){K=a;this.updateAuthor(K);};this.updateAuthor=function(b){for(var c in Q){var a=Q[c];
if(a.authorId===b.authorId){a.updateAuthorName(b.name);}}};this.scale=function(){aa();var a=P(false);ac();R(false,a);};this.handleCheckedAuthorListChange=function(c){for(var a in af){var b=af[a];
if($.inArray(b.annotation.author,c)!==-1){b.show();b.authorHidden=false;}else{b.hide();b.authorHidden=true;}}};var af={},L={},ab={};var Q={};var ad=[];
var K;var T=false;var ag=function(j,h,c,i,b,a,g,e){var d=ak(j);if(d){d.setContent(c);d.authorName=K.name;return d.comment;}var f;if(h.comment){f=h.comment;
}else{if(ad.length==0){W.show();}f=V(j,h,b,e);h.comment=f;}d=ap(f,j,c,i,b,a,e);if(g){W.focusComment(f,true,d);}else{ah(f,false);}return f;};var Y=function(a){if(a){a.deleteAllReplies();
W.destroyComment(a.id);$(".comment-pane .overflow-close-button").click();}};var ap=function(h,j,d,i,c,a,g){var f=U||c!=K.authorId;var e=h.addCommentReply(new CommentReply(j,c,a,d,i,f));
Q[e.id]=e;$(e).bind({replyDeleteRequested:function(k){am(k);},commentUpdated:function(k){I(k);},heightChanged:function(k){aa();}});if(g!=false){aa();var b=P(false,h.annotation.pageNumber);
R(false,b);}return e;};var O=function(a){var c=Q[a];if(c){var b=c.comment;b.destroyCommentReply(c);if(b.getNumReplies()==0){Y(b);}aa();var d=P(false,b.annotation.pageNumber);
R(false,d);}};var V=function(e,d,g,c){var b=!U&&((g==K.authorId)||S);var f=new Comment(e,d,an(d.pageNumber),U,b);$(f).bind({commentDeleteRequested:function(h){ao(h);
},addReplyRequested:function(i){var h=i.target;if(h){ag(null,h.annotation,"",h.getMaxOrderIndex()+1,K.authorId,K.name,true);}},commentFocused:function(h){$(W).trigger("commentFocused",[h]);
},commentDefocused:function(i){var h=i.target;var j=P(false,h.annotation.pageNumber);R(false,j);}});af[f.id]=f;ai(f);if(c!=false){aa();var a=P(false,f.annotation.pageNumber);
R(false,a);}return f;};var ai=function(e){var a=e.getYPosition();var f=e.annotation.pageNumber;var c;for(c=0;c<ad.length;c++){var d=ad[c];var b=d.annotation.pageNumber;
if(f<b||f==b&&a<d.getYPosition()){break;}}ad.splice(c,0,e);};var X=function(a){var b;for(b=0;b<ad.length;b++){var c=ad[b];if(c==a){break;}}ad.splice(b,1);
};var aj=function(a){var b=a.getYPosition();var c;for(c=0;c<ad.length;c++){var d=ad[c];if(d==a){break;}}ad.splice(c,1);ai(a);};var aa=function(){if(ad.length==0){return;
}var f=ad[0];f.setViewPosition(f.getYPosition());var h,e,d,a;for(var b=1;b<ad.length;b++){h=ad[b-1];e=ad[b];d=h.getViewPosition()*DocumentManager.DRAWSCALE;
a=e.getYPosition()*DocumentManager.DRAWSCALE;var g=e.annotation.pageNumber==h.annotation.pageNumber?Math.max(0,d+(h.getHeight()-a)+10):0;var c=e.getYPosition()+(g/DocumentManager.DRAWSCALE);
e.setViewPosition(c);}};var ak=function(a){return Q[a];};var I=function(a){$(W).trigger("commentUpdated",[a.target]);};var ao=function(a){Y(a.target);};
var am=function(a){$(W).trigger("commentDeleted",[a.target.id]);O(a.target.id);};var R=function(c,b){if(typeof(b)!="undefined"&&b!=null&&(c||!T)){var a=$("#page"+(parseInt(b.annotation.pageNumber)-1));
if(c&&b!=null){a.find(".comment-pane").css("z-index",100);var d=(a.offset().top+b.getViewPosition()*DocumentManager.DRAWSCALE+b.getDOMElement().height()+33)-a.offset().top;
a.find(".commentline.layer").height(d);a.find(".comment-pane").height(d);}else{$(".comment-pane").css("z-index",12);a.find(".commentline.layer").height("100%");
a.find(".comment-pane").height("100%");}}};var P=function(b,c){var d=ad[ad.length-1];if(b||!T){for(var a=0;a<ad.length;++a){if(c==null||c==ad[a].annotation.pageNumber){ah(ad[a],b);
d=ad[a];}}$(".comment-pane").removeClass("transparent");$(".layer.commentline").removeClass("transparent");if(b){$('.page-outer[pagenum!="'+(parseInt(c)-1)+'"]').find(".comment-pane").addClass("transparent").end().find(".layer.commentline").addClass("transparent");
}}return d;};var ah=function(a,b){if(a.authorHidden==true||(al(a)&&!b)){a.hide();if(a.overflowHidden!=true&&b==false){a.overflowHidden=true;if(ab[a.annotation.pageNumber]!=null){ab[a.annotation.pageNumber]=ab[a.annotation.pageNumber]+1;
}else{ab[a.annotation.pageNumber]=1;}}}else{a.show();if(a.overflowHidden==true){ab[a.annotation.pageNumber]=ab[a.annotation.pageNumber]-1;a.overflowHidden=false;
}}N(a.annotation.pageNumber,ab[a.annotation.pageNumber]>0);};var al=function(a){var b=false;var c=$("#page"+(parseInt(a.annotation.pageNumber)-1));if(a.getViewPosition()*DocumentManager.DRAWSCALE+a.getDOMElement().height()>c.height()){b=true;
}return b;};var N=function(c){var d=$("#page"+(parseInt(c)-1)).find(".comment-pane .overflow-button");var a=$("#page"+(parseInt(c)-1)).find(".comment-pane .overflow-close-button");
var b=ab[c];if(typeof(b)!="undefined"&&b>0){d.show();}else{d.hide();}a.hide();};var Z=function(a){return $("#page"+(parseInt(a)-1)).find(".commentline.layer");
};var an=function(a){var c=null;if(L[a]){c=L[a];}else{var b=Z(a);c=Raphael(b.get(0),"100%","100%");L[a]=c;}return c;};var ae=function(){};var J=function(){$("#CommentPanelCloseBtn").live("click",function(a){$(document.body).addClass("hide-commentpanel");
});$(".comment-pane .overflow-button").live("click",function(a){var b=parseInt($(this).closest(".page-outer").attr("pagenum"))+1;var c=$(this).closest(".comment-pane").find(".overflow-close-button");
var d=P(true,b);aa();R(true,d);c.show();T=true;});$(".comment-pane .overflow-close-button").live("click",function(a){T=false;var b=parseInt($(this).closest(".page-outer").attr("pagenum"))+1;
var c=$(this).closest(".comment-pane").find(".overflow-close-button");var d=P(false,b);aa();R(false,d);c.hide();});};var ac=function(){};M();};var ContextMenu=function(){var j=this;
var f=function(){i=$("#AnnotationMenu");h();};this.show=function(l,a,e){g=e;$(document).bind("mousedown",j.hide);var b=$("#DocHolder").offset();var d=$("#DocHolder").scrollTop();
var c=$("#DocHolder").scrollLeft();i.find("li").hide();switch(e.type){case AnnoTypes.HIGHLIGHT:if(e.color==0){i.find(".strikeout").show();}else{i.find(".highlight").show();
}break;case AnnoTypes.ANCHOR:i.find(".anchor").show();break;case AnnoTypes.AREA:i.find(".area").show();break;case AnnoTypes.DRAWING:i.find(".drawing").show();
break;case AnnoTypes.TEXTBOX:i.find(".textbox").show();break;}i.css({top:"",left:""}).offset({top:a+d-b.top,left:l+c-b.left}).show();};this.hide=function(){$(document).unbind("mousedown",j.hide);
i.hide();};var g;var i;var h=function(){$(".contextMenu").live("contextmenu",function(){return false;});i.find("li").bind("mousedown",function(){return false;
});i.find("li").bind("click",function(){var a={action:($(this).attr("action")).split(" "),annotation:g};$(j).trigger("itemClicked",[a]);});};f();};var DocViewer=function(bs,bj,aH,aX,aV){var bl=this;
var aW=false,bh=null,bx=null,a7=null,av=null,aJ=null,aG=bj,bw=null,bd=null,aB=null,a3=null;var aR=function(){};this.run=function(){var g=Utilities.isBrowserCompatible();
aW=bs.readonly;bd=new Toolbar(aW,bs.pageCount,aX);bx=new AnnotationPanel(aW);a7=new AuthorPanel(bs);av=new SidePanel(aH);bh=new AnnotationManager(aV,aW,bd);
aJ=new DocTitle(bs.title,aW);bw=new Model();a3=new ContextMenu();aB=new SharingDialog(bs.uuid);aI();aZ();bf();by();bm();ax();aP();a5();bp();bo();aS(INITIAL_AUTHOR_INFO);
ba(DocViewer.SELECT_MODE);aB.setShareParameters(bs.sharingParams);aG.setInitialZoom();bh.scale();var f=bw.getUserPrefs();var e=f.annoTbShowing;bd.setAnnotateToolbarState(e,true);
var a=f.drColor!=null&&typeof(f.drColor)!="undefined"?f.drColor:INITIAL_PEN_COLOR;var d=f.tbColor!=null&&typeof(f.tbColor)!="undefined"?f.tbColor:0;var h=f.tbSize!=null&&typeof(f.tbSize)!="undefined"?f.tbSize:12;
var b=f.tbBGColor!=null&&typeof(f.tbBGColor)!="undefined"?f.tbBGColor:-1;var c=f.hlColor!=null&&typeof(f.hlColor)!="undefined"?f.hlColor:16774792;bd.initializeDrawColor(a);
bd.initializeTextboxColor(d);bd.initializeTextboxSize(h);bd.initializeTextboxBGColor(b);bd.initializeHighlightColor(c);if(!aW&&!f.tut){be();bw.updateUserPref("tut",1);
}if(aW){at=false;}};var aI=function(){$(bh).bind({annotationUpdated:function(b,a){bk(a,function(d){if(d){}});var c=bw.getUserPrefs();if(!c.sidePanelShown){a7.flash();
bw.updateUserPref("sidePanelShown",1);}},annotationDeleted:function(b,a){aw(a,function(c){if(c){}});},annotationContextMenu:function(b,a){a3.show(a.x,a.y,a.annotation);
},commentUpdated:function(b,a){bw.saveComment(a);bx.updateComment(a);},commentDeleted:function(b,a){bw.deleteComment(a);bx.deleteComment(a);},commentPanelVisibilityChanged:function(a){aG.resizeForCommentPanel();
bh.scale();}});};var aZ=function(){$(bx).bind({annotationClick:function(c,f){var d=bh.getAnnotation(f);if(d){var b=d.getAnnoLocationInfo();var e=$("#page"+(parseInt(d.pageNumber)-1)).offset().top;
var a=$("#DocHolder").offset().top;aG.scrollTo(d.pageNumber,b+e-a);}}});};var bf=function(){$(av).bind({opened:function(){aG.resize();bh.scale();},closed:function(){aG.resize();
bh.scale();}});};var by=function(){$(a7).bind({authorInfoChange:function(b,c){var a=bw.getCurrentAuthorInfo();a.name=c.name;a.email=c.email;bw.setAuthorInfo(a,null,aW);
if(a.name){$.cookie("cc_authorname",a.name,{expires:365});}a=bw.getCurrentAuthorInfo();bx.updateAuthorInfo(a);bh.setActiveAuthorInfo(a);},authorLeave:function(a){bw.setAuthorInactive();
},sharingButtonClick:function(a){aB.open(bw.getCurrentAuthorInfo().authorId);},authorHoverChange:function(b,c,a){bx.handleAuthorHoverChange(c,a);},checkedAuthorListChange:function(b,a){bx.handleCheckedAuthorListChange(a.authorIdList);
bh.updateVisibleAuthors(a.authorIdList);},loginRequest:function(c,b,a){az(b,a,function(d){if(!d){aE(b);bt(b,function(e){authorpanel.loginRequestedCallback(d);
aS(e);});}else{authorpanel.loginRequestedCallback(d);}});}});};var bm=function(){$(aJ).bind({titleUpdated:function(a,b){bw.setTitle(b,function(c){if(c){bw.log(LogTypes.ERROR,"Error setting document title:"+c.toString());
}});}});};var a5=function(){$(a3).bind({itemClicked:function(b,c){switch(c.action[0]){case"delete":bh.clearAnnotation(c.annotation);aw(c.annotation.id,function(d){if(d){}});
break;case"color":var a=parseInt(c.action[1]);switch(c.annotation.type){case AnnoTypes.HIGHLIGHT:bh.setHighlightColor(a,c.annotation);break;case AnnoTypes.DRAWING:bh.setDrawingColor(a,c.annotation);
break;case AnnoTypes.TEXTBOX:bh.setTextboxColor(a,c.annotation);break;}break;case"addcomment":bh.attachComment(c.annotation);break;case"addreplacement":bh.addReplacementText(c.annotation);
}a3.hide();}});};var ax=function(){$(aG).bind({currentPageChange:function(b,a){bd.setCurrentPage(a);},setZoomLevel:function(a,b){bd.setZoomUI(b);bh.scale();
}});};var aP=function(){$(bd).bind({annotateToolbarVisibilityChange:function(b,a){bw.updateUserPref("annoTbShowing",a);},highlightRequested:function(c,b,a){setTimeout(function(){bh.createHighlight(b,a);
},0);},highlightModeActivated:function(a){aD(true);},highlightModeDeactivated:function(a){aD(false);},strikeoutRequested:function(a,b){bh.createStrikeout(b);
},strikeoutModeActivated:function(a){aF(true);},strikeoutModeDeactivated:function(a){aF(false);},drawingModeActivated:function(a){bu(true);},drawingModeDeactivated:function(a){bu(false);
},textboxModeActivated:function(b,a){bq=a===true;a4(true);},textboxModeDeactivated:function(a){a4(false);},commentModeActivated:function(b,a){a6(a,true);
},commentModeDeactivated:function(b,a){a6(a,false);},commentModeChanged:function(b,a){a6(a,true);},areaModeActivated:function(a){aC(true);},areaModeDeactivated:function(a){aC(false);
},anchorModeActivated:function(a){bn(true);},anchorModeDeactivated:function(a){bn(false);},anyModeDeactivated:function(a){ba(bb);},pageUp:function(a){aG.pageUp();
},pageDown:function(a){aG.pageDown();},goToPage:function(b,a){aG.goToPage(a);},zoomIn:function(){aG.zoomIn();},zoomOut:function(){aG.zoomOut();},setZoom:function(a,b){aG.setZoom(b);
bh.scale();},setDrawColor:function(b,a){bh.setDrawingColor(a.hex);bw.updateUserPref("drColor",a.index);},setTextColor:function(b,a){bh.setTextboxColor(a.hex);
bw.updateUserPref("tbColor",a.index);},setTextSize:function(b,a){bh.setTextboxSize(a);bw.updateUserPref("tbSize",a);},setTextBGColor:function(b,a){bh.setTextboxBGColor(a);
bw.updateUserPref("tbBGColor",a);},setHighlightColor:function(a,b){aA();bw.updateUserPref("hlColor",b);},shareBtnClicked:function(){aB.open(bw.getCurrentAuthorInfo().authorId);
},exportRequested:function(b,e){var c=function(j,i){if(IS_DEMO){alert("Your annotations will not be included because you are viewing this document in demo mode.");
}switch(j.errorCode){case 0:if(i==1){if(!DEBUG){_gaq.push(["_trackEvent","download","annotated"]);}location.href="/download/m/?uuid="+bs.uuid+"&shortId="+bs.shortId+"&marked="+j.uuid;
bd.exportComplete(0,i,j);}else{if(i==2){if(!DEBUG){_gaq.push(["_trackEvent","download","google-docs"]);}$.ajax({type:"POST",url:"/webservice/document/export",data:{marked:j.uuid,uuid:bs.uuid,shortId:bs.shortId},success:function(k){if(k=="error"){return;
bw.getExportPermissions(function(l,m){window.location.hash="";if(!l){bd.exportComplete(2,i,null,m);}else{f(i);}});}else{bd.exportComplete(0,i,k);}},error:function(m,k,l){window.location.hash="";
bd.exportComplete(1,i,"");}});}}break;case 1:alert("We are unable to generate your document.  The original may be copy protected.");bd.exportComplete(1,i,"");
break;case 2:alert("There was an error generating your document. Please contact support.");bd.exportComplete(1,i,"");break;case 3:alert("There was an error printing your document. Please contact support.");
bd.exportComplete(1,i,"");break;case 4:default:alert("There was an error generating your document. Please contact support.");bd.exportComplete(1,i,"");
break;}};var f=function(k){var j=bw.getAllAnnotations();var l=false;for(var i in j){var m=j[i];if(m.type==AnnoTypes.HIGHLIGHT&&!m.rectangles){l=true;break;
}}if(l){alert("Note: One or more highlights in this document will not be shown because they were created before Crocodoc's update in July, 2010.");}$.ajax({url:"/printer/render",type:"POST",data:{uuid:bs.uuid,shortId:bs.shortId},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){c(n,k);
},error:function(p,o,n){alert("There was an error generating your document. Please contact support.");bd.exportComplete(1,k,"");}});};var h=null;switch(e){case 0:if(!DEBUG){_gaq.push(["_trackEvent","download","original"]);
}location.href="/download/?uuid="+bs.uuid+"&shortId="+bs.shortId;break;case 1:f(e);break;case 2:var a=false;for(var d in bw.getAllAnnotations()){a=true;
}for(var d in bw.getAllComments()){a=true;}var g=false;if(a){g=confirm("Include annotations within this document?");}if(g){bd.startExport();f(1);}else{location.href="/download/?uuid="+bs.uuid+"&shortId="+bs.shortId;
}}}});};var bv=null;var bp=function(){$("#DocHolder").mousedown(aM);$(window).smartresize(aK);$("#DocHolder").scroll(bg);};$("#LeftPane").bind("touchstart",function(a){au(a);
},false);$("#LeftPane").bind("touchmove",function(a){a1(a);},false);$("#LeftPane").bind("touchend",function(a){aT(a);},false);var au=function(b){var a=b.originalEvent.touches;
bv=a[0].pageY;};var a1=function(c){var b=c.originalEvent.touches[0];c.preventDefault();var a=bv-b.pageY;bv=b.pageY;$("#DocHolder").scrollTop($("#DocHolder").scrollTop()+a);
};var aT=function(a){};var aD=function(a){if(a){ba(DocViewer.HIGHLIGHT_MODE);}else{ba(bb);}};var aF=function(a){if(a){ba(DocViewer.STRIKEOUT_MODE);}else{ba(bb);
}};var bu=function(a){if(a){ba(DocViewer.DRAW_MODE);}else{ba(bb);}};var a4=function(a){if(a){ba(DocViewer.TEXTBOX_MODE);}else{ba(bb);}};var a6=function(b,a){switch(b){case Toolbar.ANCHOR_COMMENT_MODE:bn(a);
break;case Toolbar.AREA_COMMENT_MODE:aC(a);break;case Toolbar.TEXT_COMMENT_MODE:a9(a);break;}};var aC=function(a){if(a){ba(DocViewer.AREA_MODE);}else{ba(bb);
}};var bn=function(a){if(a){ba(DocViewer.ANCHOR_MODE);}else{ba(bb);}};var a9=function(a){if(a){ba(DocViewer.TEXT_COMMENT_MODE);}else{ba(bb);}};var bb,bc;
var bA,aQ,aL,ay,br,aN,aY;var bq=false;var ba=function(a){bh.defocusActiveAnnotation(true,true,true,true,true,true);if(bc==a){return;}bA=false;aQ=false;
strikeoutMode=false;aL=false;ay=false;br=false;aN=false;aY=false;bh.deactivateAllModes();switch(a){case DocViewer.SELECT_MODE:bb=a;bA=true;break;case DocViewer.HIGHLIGHT_MODE:aQ=true;
bh.activateAnnotationMode(a);break;case DocViewer.STRIKEOUT_MODE:strikeoutMode=true;bh.activateAnnotationMode(a);break;case DocViewer.TEXTBOX_MODE:aL=true;
bh.activateAnnotationMode(a);break;case DocViewer.DRAW_MODE:ay=true;bh.activateAnnotationMode(a);break;case DocViewer.ANCHOR_MODE:br=true;bh.activateAnnotationMode(a);
break;case DocViewer.AREA_MODE:aN=true;bh.activateAnnotationMode(a);break;case DocViewer.TEXT_COMMENT_MODE:aY=true;bh.activateAnnotationMode(a);break;}bc=a;
aA();};var aM=function(a){if(bc==DocViewer.SELECT_MODE){bh.defocusActiveAnnotation(true,true,true,true,true,true);bh.defocusActiveComment();}};var aK=function(a){aG.resize();
bh.scale();};var bg=function(a){bh.endCurrentDrawing();};var aA=function(){switch(bc){case DocViewer.HIGHLIGHT_MODE:a0(DocViewer.CURRENT_HL_CURSOR);break;
case DocViewer.STRIKEOUT_MODE:a0(DocViewer.STRIKEOUT_CURSOR);break;case DocViewer.TEXTBOX_MODE:a0(DocViewer.TEXTBOX_CURSOR);break;case DocViewer.DRAW_MODE:a0(DocViewer.PENCIL_CURSOR);
break;case DocViewer.ANCHOR_MODE:a0(DocViewer.COMMENT_ANCHOR_CURSOR);break;case DocViewer.AREA_MODE:a0(DocViewer.COMMENT_AREA_CURSOR);break;case DocViewer.TEXT_COMMENT_MODE:a0(DocViewer.COMMENT_TEXT_CURSOR);
break;default:a0(DocViewer.NO_CURSOR);}};var a8=-1;var a0=function(c){if(c==a8&&c!=DocViewer.CURRENT_HL_CURSOR){return;}a8=c;var b=$(".layer.anno").add($(".page"));
b.removeClass("drw_cursor tb_cursor hl_yellow_cursor hl_orange_cursor hl_green_cursor hl_blue_cursor strikeout_cursor canchor_cursor carea_cursor ctext_cursor nw_resize_cursor ne_resize_cursor");
switch(a8){case DocViewer.CURRENT_HL_CURSOR:var a=Highlight.colorLookup[bd.newHighlightColor].cursorClass;b.addClass(a);break;case DocViewer.TEXTBOX_CURSOR:b.addClass("tb_cursor");
break;case DocViewer.STRIKEOUT_CURSOR:b.addClass("strikeout_cursor");break;case DocViewer.PENCIL_CURSOR:b.addClass("drw_cursor");break;case DocViewer.COMMENT_ANCHOR_CURSOR:b.addClass("canchor_cursor");
break;case DocViewer.COMMENT_AREA_CURSOR:b.addClass("carea_cursor");break;case DocViewer.COMMENT_TEXT_CURSOR:b.addClass("ctext_cursor");break;case DocViewer.NW_RESIZE_CURSOR:b.addClass("nw_resize_cursor");
break;case DocViewer.NE_RESIZE_CURSOR:b.addClass("ne_resize_cursor");break;case DocViewer.NO_CURSOR:break;}};var aS=function(a){if(!aW){bw.setAuthorInfo(a,null,aW);
if(a.name){a.name=unescape(a.name);}a7.setActiveAuthorInfo(a);bx.updateAuthorInfo(a);bh.setActiveAuthorInfo(a);}};var bk=function(a,b){bw.saveAnnotation(a,b);
bx.updateAnnotation(Utilities.clone(a,true));};var aw=function(a,b){bw.deleteAnnotation(a,b);bx.deleteAnnotation(a);};var bo=function(){bw.loadDocument(bs,function(){bi();
var d=bw.getAllAnnotations();var c=bw.getAllComments();for(var b in d){bh.renderAnnotation(d[b]);}for(var b in c){bh.renderComment(c[b],false);}bh.updateCommentPositions();
bx.setAnnotations(d,c);if(at){var a=location.search.indexOf("dr")!=-1;setTimeout(function(){bz(a);},4000);}});};var bi=function(){var a=bw.getKnownAuthors();
bx.setKnownAuthors(a);a7.setKnownAuthors(a);bh.setKnownAuthors(a);};var aU=[[4,180],[10,180],[20,120],[60,300],[300,60*60*12]];var a2=function(){var d=new Date();
var f=d.getTime()-(bw.lastModified||bw.startTime).getTime();var a=0;for(var b=0,c=aU.length;b<c;b++){var e=aU[b];a+=e[1]*1000;if(f<a){return e[0]*1000;
}}return null;};var at=true;var bz=function(a){if(!at){return;}bw.refreshDocument(bs.uuid,function(f,i,c,e,h,g){if(f){bw.log(LogTypes.ERROR,f);return;}for(var j=0;
j<i.length;j++){bh.renderAnnotation(i[j]);}for(var j=0;j<c.length;j++){bh.clearAnnotation(c[j]);}for(var j=0;j<e.length;j++){var b=e[j];a7.updateAuthorInfo(b);
bx.updateAuthorInfo(b);bh.updateAuthor(b);}for(var j=0;j<h.length;j++){bh.renderComment(h[j]);}for(var j=0;j<g.length;j++){bh.clearCommentReply(g[j].id);
}bx.updateAnnotations(i,c);bx.updateComments(h,[]);if(!a&&at){var d=a2();if(typeof(d)==="number"){setTimeout(function(){bz();},d);}else{at=false;}}});};
var be=function(){$(".support-email").attr("href","mailto:support@crocodoc.com").text("support@crocodoc.com");$("#Tutorial").overlay({expose:{maskId:"OverlayMask",color:"#000",loadSpeed:200,opacity:0.4},closeOnClick:true,api:true,top:0,onBeforeLoad:aO}).load();
};var aO=function(){var g=$("#AnnotateButton"),f=$("#ShareButton"),a=$("#DownloadButton"),i=$("#OpenSidebarButton");var b=g.offset(),e=f.offset(),c=a.offset(),h=i.offset();
var d=$("#LeftPane");$("#AnnoTut").css({top:b.top,left:(b.left-290-8)});$("#ShareTut").css({top:e.top+10,left:e.left-130-5});$("#DownloadTut").css({top:c.top+a.outerHeight()+5,left:c.left-70});
$("#CollabTut").css({top:h.top+i.outerHeight()+3,left:h.left-60});$("#MainTut").css({left:(d.outerWidth()/2)-(470/2)});$("#TutQuestions").click(function(j){$(this).hide();
$("#TutFAQ").show();});};var az=function(b,a,c){};var aE=function(a){};var bt=function(b,a){};aR();};DocViewer.SELECT_MODE=0;DocViewer.STRIKEOUT_MODE=1;
DocViewer.HIGHLIGHT_MODE=2;DocViewer.TEXTBOX_MODE=3;DocViewer.DRAW_MODE=4;DocViewer.ANCHOR_MODE=5;DocViewer.AREA_MODE=6;DocViewer.TEXT_COMMENT_MODE=7;DocViewer.NO_CURSOR=-1;
DocViewer.OPEN_HAND_CURSOR=0;DocViewer.CLOSED_HAND_CURSOR=1;DocViewer.CARET_CURSOR=2;DocViewer.CURRENT_HL_CURSOR=3;DocViewer.TEXTBOX_CURSOR=4;DocViewer.STRIKEOUT_CURSOR=5;
DocViewer.HAND_POINTER=6;DocViewer.PENCIL_CURSOR=7;DocViewer.COMMENT_AREA_CURSOR=8;DocViewer.COMMENT_TEXT_CURSOR=9;DocViewer.NW_RESIZE_CURSOR=10;DocViewer.NE_RESIZE_CURSOR=11;
DocViewer.COMMENT_ANCHOR_CURSOR=12;var DocumentManager=function(N){var O=this;var I=function(){DocumentManager.PAGE_COUNT=N.pageCount;for(var a=0;a<N.pageCount;
++a){aj[a]={status:T.NONE,loadTimeoutId:null};}if(N.status==DOCUMENT_STATUS.CONVERTING){}else{for(var a=0;a<Math.min(N.pageCount,5);a++){aa(a);}}$(".page-outer").bind("appear",function(b){H(this);
});$(".page-outer").lazyload({threshold:400,container:"#DocHolder"});ah.scroll(function(b){var c=V();if(c!==J){J=c;$(O).trigger("currentPageChange",[J]);
}});$(".bg-img").live("mousedown",function(b){b.preventDefault();});};this.setInitialZoom=function(){if(N.fileExt=="ppt"||N.fileExt=="pptx"){var e=Y(true);
var d=L();if(e<d){ac("w");}else{ac("h");}}else{var a=Y(true);var f=Y(false);var b=false;var c;if(a>1){c="1";}else{if(a>0.5){c="w";}else{c="w";b=true;}}ac(c,b);
}$(".page-outer").css("visibility","visible");};this.pageLoaded=function(b,c,a){S(b,c,a);};this.pageUp=function(){O.goToPage(Math.max(1,J-1));};this.pageDown=function(){O.goToPage(Math.min(N.pageCount,J+1));
};this.goToPage=function(a){var b=$("#page"+(a-1)).find(".page");var c=b.closest(".page-outer");ag(b,al-(parseInt(c.css("margin-bottom"))/2));};this.scrollTo=function(c,a,b){var d=(b?0:ah.scrollTop())-al;
ah.scrollTop(a+d);if(c!==J){J=c;$(O).trigger("currentPageChange",[J]);}};this.setZoom=function(a){ac(a);};this.zoomIn=function(){var c=DocumentManager.SCALE;
var a=Y(true);var e=L();var b;var f=c;for(var d=0;d<DocumentManager.ZOOMLEVELS.length;++d){if(DocumentManager.ZOOMLEVELS[d]>c){if($.browser.msie&&c==Math.floor(DocumentManager.ZOOMLEVELS[d]*10)/10){continue;
}b=DocumentManager.ZOOMLEVELS[d];f=b;break;}}if(W!="fill"&&c<a&&a<b){b=a;f="w";}if(W!="fit"&&c<e&&e<b){b=e;f="h";}ac(f);};this.zoomOut=function(){var d=DocumentManager.SCALE;
var a=Y(true);var f=L();var c;var b=d;for(var e=DocumentManager.ZOOMLEVELS.length-1;e>=0;--e){if(DocumentManager.ZOOMLEVELS[e]<d){c=DocumentManager.ZOOMLEVELS[e];
b=c;break;}}if(W!="fill"&&d>a&&a>c){c=a;b="w";}if(W!="fit"&&d>f&&f>c){c=f;b="h";}ac(b);};this.resize=function(){if(W=="fit"){ac("h");}else{if(W=="fill"){ac("w");
}}};this.resizeForCommentPanel=function(){var a=Y(true);if(W=="fill"||a<DocumentManager.SCALE){var b=a<0.75?0.75:"w";ac(b);}};var ab=5000;var W;var T={NONE:0,LOADING:1,LOADED:2,ERROR:3};
var aj=[];var M={};var ai=$("#Doc"),ah=$("#DocHolder");var ak=[];var al=parseFloat(ai.css("marginTop").replace("px",""));var U=$("#page0").outerHeight()+0+al;
var J=1;var K={1:1},af=0;var Q=function(){for(var b in N.pageInfo){var a=N.pageInfo[b];if(a&&!a.dummy){K[Number(b)]=1;af++;}}X(af,N.pageCount);$(".inc-status").show();
};var X=function(a,b){$(".inc-status").find(".numerator").text(a).end().find(".denomenator").text(b).end().find(".prog").css("width",(a/b*100)+"%");};var G=3000;
var P=function(){var b=[];for(var a in K){if(K[a]!=2){K[a]=2;b.push(a);}}$.ajax({type:"GET",url:"/webservice/document/status",data:"task_id="+N.task_id+"&shortId="+N.shortId+"&pad=false&known="+JSON.stringify(b)+"&withdoc=true",cache:false,success:function(c){c=JSON.parse(c);
if(c==null){}else{var f=c.document.status;if(f==DOCUMENT_STATUS.ERROR){}else{if(f==DOCUMENT_STATUS.CONVERTING){setTimeout(P,G);}else{if(f==DOCUMENT_STATUS.AVAILABLE){$(".inc-status .msg").text("Complete");
setTimeout(function(){$(".inc-status").fadeOut();},1000);}}}var g=c.document.pageInfo;var e=N.pageInfo;for(var d in g){e[d]=g[d];d=Number(d);if(K[d]!=2){K[d]=1;
af++;}}X(af,N.pageCount);Z();N.embeddedFontInfo=c.document.embeddedFontInfo;ae();}},error:function(e,c,d){}});};var ae=function(){var b=[];for(var a=0;
a<N.embeddedFontInfo.length;++a){if($.inArray(N.embeddedFontInfo[a],ak)==-1){ak.push(N.embeddedFontInfo[a]);b.push(N.embeddedFontInfo[a]);}}ad(b);};var ad=function(d){var h=[];
for(var f=0;f<d.length;f++){var e=d[f];var b=$("#FontPreloader").find(".f"+e).get(0);if(!b){b=$('<span class="f'+e+'">&nbsp;</span>').get(0);$("#FontPreloader").append(b);
}if($.browser.msie&&$.browser.version<=8){var g=$(b).css("font-family").replace(/['"]/g,"");if(!g||g[0]!="f"){h.push(e);}}}if($.browser.msie&&$.browser.version<=8&&h.length>0){var i="";
for(var f=0;f<h.length;f++){var e=h[f];var c=N.assetsLocation+"fonts/"+e+".eot";i+=".f"+e+" { font-family: 'f"+e+"', sans-serif; } ";i+="@font-face { font-family: 'f"+e+"'; src: url('"+c+"'); } ";
}if(document.styleSheets.length<31){var a=document.createElement("style");a.setAttribute("type","text/css");$("head").append(a);a.styleSheet.cssText=i;
}else{}}};var Z=function(){var b=[];for(var a in M){if(!N.pageInfo[a].dummy){b.push(a);}else{}}for(var c=0;c<b.length;++c){var a=b[c];delete M[a];aa(a-1);
}};var H=function(a){var b=$(a).attr("pagenum");aa(b);};var aa=function(a){a=parseInt(a);var g=a+1;var b=aj[a];if(b.status!==T.NONE){return;}if(N.pageInfo[g].dummy){M[g]=1;
return;}$("#page"+a).css({width:N.pageInfo[g].width,height:N.pageInfo[g].height});$(".page-outer").lazyload("refresh",{page:a});var e=3-a.toString().length;
var f=e==2?"00":e==1?"0":"";var c=N.assetsLocation+"images/page-"+f+a+".png";$("<img />").bind("load",function(){var h=$(this).attr("src");if(aj[a].status==T.LOADED){$("#page"+a+" .bg-img").attr("src",h);
}else{aj[a].imgSrc=h;}}).attr("src",c);var d=document.createElement("script");d.text="doc_"+a+"_js();";d.id="jsonp_page"+a;d.type="text/javascript";b.status=T.LOADING;
b.loadTimeoutID=setTimeout(function(){R(a);},ab);b.scriptElem=d;$("head").get(0).appendChild(d);};var S=function(c,e,a){var b=aj[e];delete b.scriptElem;
b.status=T.LOADED;clearTimeout(b.loadTimeoutID);var d=$("#page"+e);d.find(".throbber-container").remove();d.find(".page").replaceWith(a);d.find(".page")[0].style.visibility="visible";
if(aj[e].imgSrc){d.find(".bg-img").attr("src",aj[e].imgSrc);}var f=d.find(".layer.highlight");f.insertBefore(d.find(".layer.text"));};var R=function(a){var b=aj[a];
if(b.status!==T.LOADED){b.status=T.ERROR;}};var ag=function(e,b){var c=e.parents(".page-outer");var d=parseInt(c.attr("pagenum"))+1;var a=-ah.offset().top+e.offset().top+b;
O.scrollTo(d,a);};var V=function(){var a=(ah.scrollTop()+(ah.height()/2))/Math.max($("#Doc").height(),ah.height());return Math.floor(a*N.pageCount)+1;};
var ac=function(a,b){var c;if(a=="w"){var d=b&&true;c=Y(!b);W="fill";}else{if(a=="h"){c=L();W="fit";}else{c=parseFloat(a);W="scale";}}if($.browser.msie&&$.browser.version<=8){c=Math.floor(c*10)/10;
}DocumentManager.SCALE=c;DocumentManager.DRAWSCALE=DocumentManager.SCALE*DocumentManager.PIXPNTRATIO;if(a=="h"){$("#Doc").css("font-size",c*10+"px");O.goToPage(J);
}else{var e=$("#DocHolder").scrollTop()/$("#Doc").height();$("#Doc").css("font-size",c*10+"px");$("#DocHolder").scrollTop($("#Doc").height()*e);}$(".page-outer").lazyload("refresh");
$(O).trigger("setZoomLevel",[a]);};var Y=function(e){var i=$("#Doc");var g=$("#page"+(V()-1)).find(".page");var c=g.outerWidth(true);var l=i.width();var h=$(".comment-pane").is(":visible")&&e?$(".comment-pane").outerWidth(true):0;
var f=((l-h)/(c))*DocumentManager.SCALE;var d=i.height();var b=f*d;var a=$("#DocHolder").height();var k=d>a;var j=b>a;if(f<1){if(k&&!j){l+=$.scrollbarWidth();
f=((l-h)/(c))*DocumentManager.SCALE;}}else{if(!k&&j){l-=$.scrollbarWidth();f=((l-h)/(c))*DocumentManager.SCALE;}}return f;};var L=function(){var d=$("#page"+(V()-1));
var b=d.outerHeight(true);var a=$("#DocHolder").outerHeight();var c=(a/b)*DocumentManager.SCALE;return Math.max(c,0.25);};I();};DocumentManager.jDocHolder=$("#DocHolder");
DocumentManager.PAGE_COUNT=-1;DocumentManager.getCurrentPage=function(){var b=(DocumentManager.jDocHolder.scrollTop()+(DocumentManager.jDocHolder.height()/2))/Math.max($("#Doc").height(),DocumentManager.jDocHolder.height());
return Math.floor(b*DocumentManager.PAGE_COUNT)+1;};DocumentManager.ZOOMLEVELS=[0.5,0.75,1,1.25,1.5,2,3];DocumentManager.SCALE=1;DocumentManager.PIXPNTRATIO=1.527777;
DocumentManager.DRAWSCALE=DocumentManager.SCALE*DocumentManager.PIXPNTRATIO;var DOCUMENT_STATUS={QUEUED:1,CONVERTING:2,AVAILABLE:3,ERROR:4};var HighlightUtilities={getRectanglesFromSelection:function(i){try{var C=[];
var A,B;HighlightUtilities.classifyHighlightedNodes(i);var I=HighlightUtilities.groupLines();var H=$(I[0]).closest(".page-outer").offset();if(H==null){return;
}for(var x=0;x<I.length;++x){var z=I[x];var D=HighlightUtilities.getActualSize(z);var G=HighlightUtilities.getLayerOffset(z,H);var v=false;var y=$(".text.layer").get(0);
if(y){if($(y).css("-moz-transform")&&$(y).css("-moz-transform")!="none"){v=true;}else{if($(y).css("-webkit-transform")){v=true;}else{if($(y).css("transform")){v=true;
}else{if($(y).css("zoom")&&$(y).css("zoom")!="normal"){v=true;}}}}}var u=v?10:1;var t=(v&&$.browser.mozilla)?10:1;C.push({x:G.left/(DocumentManager.DRAWSCALE*t),y:G.top/(DocumentManager.DRAWSCALE*t),width:D.width/(DocumentManager.DRAWSCALE*u),height:D.height/(DocumentManager.DRAWSCALE*u)});
}A=C[0].x,B=C[0].y;for(var x=1;x<C.length;++x){if(C[x].x<A){A=C[x].x;}if(C[x].y<B){B=C[x].y;}}return{rectangles:C,x:A,y:B};}finally{$(".hl").removeClass("hl");
if($.browser.msie){var F=$("font");var w=F.length;for(var x=0,E;E=F[x++];){if(E.style&&E.style.backgroundColor){var J=E.style.backgroundColor;if(J=="#000001"||J=="rgb(0, 0, 1)"){$(E).css({"background-color":"transparent"});
}}}}}},getLayerOffset:function(j,f){var g=$(j).offset();var h=g.left-f.left;var i=g.top-f.top;return{top:i,left:h};},getRangeStartPage:function(b){if($.browser.msie){return $(b.parentElement()).closest(".page-outer");
}else{return $(b.startContainer).closest(".page-outer");}},getHLRangeContent:function(b){if($.browser.msie){return Utilities.trima(b.text);}else{return Utilities.trima(Utilities.replaceNL(b.toString()," "));
}},classifyHighlightedNodes:function(z){if($.browser.msie){document.selection.empty();z.select();document.execCommand("backcolor",false,"#000001");var s=$("font");
var u=s.length;var t=[];for(var x=0,r;r=s[x++];){if(r.style&&r.style.backgroundColor){var i=r.style.backgroundColor;if(i=="#000001"||i=="rgb(0, 0, 1)"){var v=HighlightUtilities.getTextNodesBelow(r);
t=t.concat(v);}}}for(var x=0;x<t.length;++x){HighlightUtilities.wrapNode(t[x]);}document.selection.empty();}else{if(z.collapsed){return null;}var p=z.startContainer;
var w=z.endContainer;var A=z.startOffset;var B=z.endOffset;var q=false,y=false;if(B>0&&B<w.nodeValue.length&&w.nodeType==3){w.splitText(B);y=true;}if(A>0&&A<p.nodeValue.length&&p.nodeType==3){p=p.splitText(A);
if(w==p.previousSibling){w=p;}q=true;}console.log(3);var t=HighlightUtilities.getTextNodesBetween($(p).closest(".layer.text")[0],p,w);$.each(t,function(b,a){HighlightUtilities.wrapNode(a);
});window.getSelection().removeAllRanges();}},clearSelection:function(){if($.browser.msie){document.selection.empty();}else{window.getSelection().removeAllRanges();
}},groupLines:function(){var c=$(),d=[];c=$().add($(".hl")).add($(".hl").parent());c=c.filter(function(){var g=true;var b=$(this).children();if(b.filter(".hl").size()>0){g=b.filter(function(){return $(this).hasClass("hl")&&Utilities.trima($(this).text())!="";
}).size()>0;}var a=true;var h=this;$.each($(h).textNodes(),function(){if($(this).parent()!=h&&!$(this).parent().hasClass("hl")){a=false;return false;}});
return g&&a;});$.each(c,function(){var a=true;for(var b=0;b<c.length;b++){if($(this).parent()[0]==c[b]){a=false;break;}}if(a){d.push(this);}});return d;
},getActualSize:function(f){var h=$(f).height();var i=$(f).width();var j=0;var g=0;$.each($(f).find("*"),function(){if($(this).get(0).tagName.toLowerCase().indexOf("wbr")==-1){var b=$(this).height();
var a=$(this).width();j=Math.max(j,b);g=Math.max(g,a);}});return{height:Math.max(h,j),width:Math.max(i,g)};},wrapNode:function(c){var d=$('<span class="hl"></span>').append($(c).clone());
$(c).replaceWith(d);},isThereASelection:function(){if($.browser.msie){var c=null;if(document.selection.type=="Text"){c=document.selection.createRange();
if(c.text==""){return false;}return true;}else{if(document.selection.type=="None"){return false;}}return true;}else{console.log(1);var d=window.getSelection();
if(!d||d.rangeCount==0){return false;}var c=d.getRangeAt(0);if(c==null||(c.toString())==""||c.collapsed){return false;}console.log(4);if($(c.startContainer).closest(".layer.text").length==0||$(c.endContainer).closest(".layer.text").length==0){return false;
}return true;}},getSelectionRange:function(){var b=null;if(HighlightUtilities.isThereASelection()){if($.browser.msie){b=document.selection.createRange();
}else{b=window.getSelection().getRangeAt(0);}}return b;},collectTextNodes:function(g,h){var e=[];function f(a,b){if(a.nodeType==3){if(!b||b(a)){e.push(a);
}}else{for(var c=0,d=a.childNodes.length;c<d;++c){f(a.childNodes[c],b);}}}f(g,h);return e;},getTextNodesBelow:function(e){var f=[];function d(a){if(a.nodeType==3){f.push(a);
}else{for(var b=0;b<a.childNodes.length;++b){d(a.childNodes[b]);}}}d(e);return f;},getTextNodesBetween:function(n,l,h){var k=false,i=false,j=[];function m(b){var a=false;
if(b==l){k=true;if(b.nodeType==3){j.push(b);a=true;}}if(b==h){i=true;if(!a&&b.nodeType==3){j.push(b);}}else{if(b.nodeType==3){if(k&&!i&&!a){j.push(b);}}else{for(var c=0,d=b.childNodes.length;
!i&&c<d;++c){m(b.childNodes[c]);}}}}m(n);return j;},trimRange:function(b){if(!$.browser.msie){return HighlightUtilities._trimRangeFF(b);}else{return HighlightUtilities._trimRangeIE(b);
}},findNextNode:function(c,d){if(!$.browser.msie){return HighlightUtilities._findNextNodeFF(c,d);}},findPreviousNode:function(c,d){if(!$.browser.msie){return HighlightUtilities._findPreviousNodeFF(c,d);
}},findNextTextNode:function(c,d){if(!$.browser.msie){return HighlightUtilities._findNextTextNodeFF(c,d);}else{return HighlightUtilities._findNextTextNodeIE(c);
}},findPreviousTextNode:function(c,d){if(!$.browser.msie){return HighlightUtilities._findPreviousTextNodeFF(c,d);}else{return HighlightUtilities._findPreviousTextNodeIE(c);
}},_trimRangeIE:function(d){var c=Utilities.trima(d.text);d.findText(c);return d;},_findPreviousTextNodeIE:function(d){if(d.nodeType==3){return d;}for(var e=d.childNodes.length-1;
e>=0;--e){var f=d.childNodes[e];return HighlightUtilities.findPreviousTextNode(f);}},_findNextTextNodeIE:function(d){if(d.nodeType==3){return d;}for(var e=0;
e<d.childNodes.length;++e){var f=d.childNodes[e];return HighlightUtilities.findNextTextNode(f);}},_trimRangeFF:function(B){var p=true;var x=true;var s=null;
var w=null;if(B.startContainer.nodeType!=3){p=false;}if(B.endContainer.nodeType!=3){x=false;}if(p){s=HighlightUtilities._findNextTextNodeFF(B.startContainer,true);
}if(x){w=HighlightUtilities._findPreviousTextNodeFF(B.endContainer,true);}var r="";if(!s){p=false;}if(p){if(s==B.startContainer){r=s.textContent.substr(B.startOffset);
}else{r=s.textContent;}var q=Utilities.ltrima(r);while(q==""&&s&&s!=w){var C=HighlightUtilities._findNextNodeFF(s,true);if(!C){p=false;break;}s=HighlightUtilities._findNextTextNodeFF(C,true);
if(!s){p=false;break;}r=s.textContent;q=Utilities.ltrima(r);}if(p){var z=r.length-q.length;}}var u="";if(!w){x=false;}if(x){if(w==B.endContainer){u=w.textContent.substr(0,B.endOffset);
}else{u=w.textContent;}var D=Utilities.rtrima(u);while(D==""&&w&&w!=s){var C=HighlightUtilities._findPreviousNodeFF(w,false);if(!C){x=false;break;}w=HighlightUtilities._findPreviousTextNodeFF(C,false);
if(!w){x=false;break;}u=w.textContent;D=Utilities.rtrima(u);}if(x){var A=u.length-D.length;}}var t=B.cloneRange();if(p){var v=s==B.startContainer?B.startOffset:0;
v+=z;t.setStart(s,v);}if(x){var y=w==B.endContainer?w.length-B.endOffset:0;y+=A;t.setEnd(w,w.textContent.length-y);}window.getSelection().removeAllRanges();
window.getSelection().addRange(t);return t;},_findNextTextNodeFF:function(h,f){if(h.nodeType==3){return h;}if(f){var g=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,false);
g.currentNode=h;return g.nextNode();}else{var g=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,false);g.currentNode=h;var e=g.lastChild();
g.currentNode=e;return g.nextNode();}},_findPreviousTextNodeFF:function(j,g){if(j.nodeType==3){return j;}if(g){var h=document.createTreeWalker(j,NodeFilter.SHOW_TEXT,null,false);
var f=h.lastChild();if(f!=null){return f;}}var i=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,false);i.currentNode=j;return i.previousNode();
},_findNextNodeFF:function(h,f){if(f){var g=document.createTreeWalker(document.body,NodeFilter.SHOW_ALL,null,false);g.currentNode=h;return g.nextNode();
}else{var g=document.createTreeWalker(document.body,NodeFilter.SHOW_ALL,null,false);g.currentNode=h;var e=g.lastChild();g.currentNode=e;return g.nextNode();
}},_findPreviousNodeFF:function(j,g){if(g){var h=document.createTreeWalker(j,NodeFilter.SHOW_ALL,null,false);var f=h.lastChild();if(f!=null){return f;}}var i=document.createTreeWalker(document.body,NodeFilter.SHOW_ALL,null,false);
i.currentNode=j;return i.previousNode();}};var Toolbar=function(bj,aE,bh){var by=this;var a0=function(){if(!bj){aO.mousedown(bz);$("#CommentDropButton").click(aU);
$("#CommentSub li").click(aG);aV.mousedown(bd);aY.click(bf);aI.click(ba);bD.mousedown(a6);$("#DrawToolSettings .swatch").click(function(a){az(true,this.getAttribute("value"));
});$("#TextToolSettings .swatch").click(function(a){aL(true,this.getAttribute("value"));});$("#HighlightToolSettings .swatch").click(function(a){aP(true,parseInt(this.getAttribute("value")));
});$("#TextSizeSel").click(aR);$("#TextSizeSub li").click(aD);$("#TextBGBtn").click(function(a){bB(true,($(this).hasClass("white")?-1:0));});$("#AnnotateButton").click(ax);
}$("#DownloadButton").click(bi);$("#DownloadSub .fancy-sub-item").click(aH);aS.find(".close").click(function(a){aS.dialog("close");});aS.find(".authorize").click(ay);
$("#ShareButton").click(function(a){$(by).trigger("shareBtnClicked");});bC.click(bl);bt.click(aK);bp.click(a7);$("#ZoomSub li").click(bk);bb.click(aB);
aQ.click(aw);bo.bind("mousedown",function(){if(!$(this).hasClass("active")){$(this).addClass("active").text(aZ).attr("contenteditable","true");Utilities.setSelection($(this)[0]);
}}).bind("mouseup",function(){$(this).focus();}).bind("focus",function(a){}).bind("blur",function(){$(this).removeClass("active").removeAttr("contenteditable");
var a=$(this).text();if(a==""){by.setCurrentPage(aZ);}else{if(parseInt(a)!==aZ){a=parseInt(a);if(a>=1&&a<=aE){by.setCurrentPage(a);$(by).trigger("goToPage",[a]);
}else{by.setCurrentPage(aZ);}}else{by.setCurrentPage(aZ);}}}).bind("keypress",function(a){if(a.which==13){$(this).blur();}else{if(!Utilities.validateNumber(a)){return false;
}else{if(a.which==60||a.which==62){return false;}}}});by.setCurrentPage(1);bp.val(1);if(bh){aX(true,true,true);}};var aS=$("#DownloadDialog").dialog({autoOpen:false,modal:true,resizable:false,closeOnEscape:false,width:400});
var aV=$("#HighlightButton"),aY=$("#DrawButton"),aI=$("#TextboxButton"),aO=$("#CommentButton"),bD=$("#StrikeoutButton");var bC=$("#ZoomOutBtn"),bt=$("#ZoomInBtn"),bp=$("#ZoomSel"),bb=$("#PageUpBtn"),aQ=$("#PageDownBtn");
var bx=$("#AnnoSettingsSection");var bo=$("#CurrentPage");var bv=$('<img width="16" height="16" src="./checkmark16.png"/>');var aZ=1;this.setCurrentPage=function(a){a=parseInt(a);
setTimeout(function(){bo.text("Page "+(a)+"/"+aE);bb.toggleClass("disabled",a===1).toggleClass("normal",a!==1);aQ.toggleClass("disabled",a===aE).toggleClass("normal",a!==aE);
},0);aZ=a;};this.setAnnotateToolbarState=function(b,a){if(b===null||b==1){aX(true,a,true);}};this.setZoomUI=function(a){aW(a);};this.initializeDrawColor=function(a){be=a;
by.newDrawColor=a5[be];};this.initializeTextboxColor=function(a){a3=a;by.newTextColor=bs[a3];};this.initializeTextboxSize=function(a){br=a;by.newTextSize=br;
};this.initializeTextboxBGColor=function(a){bw=a;by.newTextBGColor=bw;};this.initializeHighlightColor=function(a){by.newHighlightColor=a;aP(false,by.newHighlightColor);
};this.setTextboxMode=function(c,b,a,d){this.setCurrentMode(Toolbar.TEXTBOX_MODE,d);aL(false,aT[c]);bE(false,b);bB(false,a);};this.setDrawingMode=function(a,b){this.setCurrentMode(Toolbar.DRAWING_MODE,b);
az(false,bA[a]);};this.setAnchorMode=function(a){this.setCurrentMode(Toolbar.COMMENT_MODE,a);aA(Toolbar.ANCHOR_COMMENT_MODE);};this.setAreaMode=function(a){this.setCurrentMode(Toolbar.COMMENT_MODE,a);
aA(Toolbar.AREA_COMMENT_MODE);};this.setTextMode=function(a){this.setCurrentMode(Toolbar.COMMENT_MODE,a);aA(Toolbar.TEXT_COMMENT_MODE);};var a4=Toolbar.NONE_MODE,a1=Toolbar.ANCHOR_COMMENT_MODE,bu=a4;
this.setCurrentMode=function(a,b){b=b===true;if(a===Toolbar.LAST_CURRENT_MODE){a=a4;}else{if(!b){a4=a;}}if(a==bu){return;}bu=a;aV.toggleClass("active",a===Toolbar.HIGHLIGHT_MODE).toggleClass("normal",a!==Toolbar.HIGHLIGHT_MODE);
aY.toggleClass("active",a===Toolbar.DRAWING_MODE).toggleClass("normal",a!==Toolbar.DRAWING_MODE);aI.toggleClass("active",a===Toolbar.TEXTBOX_MODE).toggleClass("normal",a!==Toolbar.TEXTBOX_MODE);
bD.toggleClass("active",a===Toolbar.STRIKEOUT_MODE).toggleClass("normal",a!==Toolbar.STRIKEOUT_MODE);aO.toggleClass("active",a===Toolbar.COMMENT_MODE).toggleClass("normal",a!==Toolbar.COMMENT_MODE);
aO.parent().toggleClass("active",a===Toolbar.COMMENT_MODE).toggleClass("normal",a!==Toolbar.COMMENT_MODE);if(a===Toolbar.COMMENT_MODE){bm(true);aX(true);
a2(false);if(!b){aM=true;}}else{if(a===Toolbar.TEXTBOX_MODE||a===Toolbar.DRAWING_MODE||a===Toolbar.HIGHLIGHT_MODE){a9(a===Toolbar.HIGHLIGHT_MODE);a8(a===Toolbar.DRAWING_MODE);
bg(a===Toolbar.TEXTBOX_MODE);aX(true);a2(true);if(!b){aM=true;}}else{a2(false);aX(aM);}}};this.startExport=function(){aF("DLWait");};this.exportComplete=function(a,c,b,d){var e="DLError";
switch(a){case 0:e="DLSuccess";break;case 2:e=d?"DLAuthorize":"DLError";break;}aF(e,c,b,d);};var a2=function(a){if(a){if($.browser.msie){bx.show().find(".subnav").removeClass("visible").hide();
}else{bx.show("slide",{direction:"left"},200).find(".subnav").removeClass("visible").hide();}}else{if(bx.is(":visible")){if($.browser.msie){bx.hide().find(".subnav").removeClass("visible").hide();
}else{bx.hide("slide",{direction:"left"},200).find(".subnav").removeClass("visible").hide();}}}};this.newHighlightColor=null;var a9=function(a){if(a){aP(false,by.newHighlightColor);
$("#HighlightToolSettings").show();}else{$("#HighlightToolSettings").hide();}};var bA={0:0,14352384:1,2511082:2,56136:3};var a5=[0,14352384,2511082,56136];
var be;this.newDrawColor=null;var a8=function(a){if(a){az(false,bA[by.newDrawColor]);$("#DrawToolSettings").show();}else{$("#DrawToolSettings").hide();
}};var aT={0:0,16711698:1,2511082:2,56136:3};var bs=[0,16711698,2511082,56136];var a3,br,bw;this.newTextColor=null,this.newTextSize=null,this.newTextBGColor=null;
var bg=function(a){if(a){aL(false,aT[by.newTextColor]);bE(false,by.newTextSize);bB(false,by.newTextBGColor);$("#TextToolSettings").show();}else{$("#TextToolSettings").hide();
}};var bm=function(a){aA(a1);};var aA=function(a){var b="split-left active";b+=(a==Toolbar.ANCHOR_COMMENT_MODE?" point":a==Toolbar.AREA_COMMENT_MODE?" area":" text");
$("#CommentButton").attr("class",b);};var aM=false;var ax=function(a){if(MOBILE){alert("Mobile support coming soon!");return;}var b=$("#AnnotateButton");
if(!b.hasClass("disabled")){aM=!aM;if(!aM){$(by).trigger("anyModeDeactivated");by.setCurrentMode(Toolbar.NONE_MODE);}aX(aM);}};var aC=false;var aX=function(c,d,e){if(c==aC){return;
}var a=$("#AnnotateButton");var b=$("#AnnotationToolbar");if(c){if(e||$.browser.msie){b.addClass("visible").show();}else{b.addClass("visible").show("slide",{direction:"up"},200);
}a.addClass("active").removeClass("normal");if(d){aM=true;}}else{if(e||$.browser.msie){b.hide().removeClass("visible");}else{b.hide("slide",{direction:"up"},200).removeClass("visible");
}a.removeClass("active").addClass("normal");}aC=c;$(by).trigger("annotateToolbarVisibilityChange",[c?1:0]);};var bd=function(){if(aV.hasClass("active")){aV.removeClass("active");
by.setCurrentMode(Toolbar.NONE_MODE);$(by).trigger("highlightModeDeactivated");}else{var a=bn(false);if(!a){aV.addClass("active");by.setCurrentMode(Toolbar.HIGHLIGHT_MODE);
$(by).trigger("highlightModeActivated");}}};var a6=function(){if(bD.hasClass("active")){bD.removeClass("active");by.setCurrentMode(Toolbar.NONE_MODE);$(by).trigger("strikeoutModeDeactivated");
}else{var a=bn(false,true);if(!a){bD.addClass("active");by.setCurrentMode(Toolbar.STRIKEOUT_MODE);$(by).trigger("strikeoutModeActivated");}}};var bf=function(a){aY.toggleClass("active");
if(aY.hasClass("active")){by.setCurrentMode(Toolbar.DRAWING_MODE);$(by).trigger("drawingModeActivated");}else{by.setCurrentMode(Toolbar.NONE_MODE);$(by).trigger("drawingModeDeactivated");
}};var ba=function(a){aI.toggleClass("active");if(aI.hasClass("active")){by.setCurrentMode(Toolbar.TEXTBOX_MODE);$(by).trigger("textboxModeActivated");
}else{by.setCurrentMode(Toolbar.NONE_MODE);$(by).trigger("textboxModeDeactivated");}};var bz=function(b){$("#CommentSub").removeClass("visible").hide();
if(aO.hasClass("active")){aO.removeClass("active");by.setCurrentMode(Toolbar.NONE_MODE);$(by).trigger("commentModeDeactivated",[a1]);}else{if(a1==Toolbar.TEXT_COMMENT_MODE){var a=bn(true);
if(a){return;}}aO.addClass("active");by.setCurrentMode(Toolbar.COMMENT_MODE);$(by).trigger("commentModeActivated",[a1]);}};var aU=function(a){var d=$("#CommentSub");
var e=aO.parent();if(d.hasClass("visible")){if(a4!==Toolbar.COMMENT_MODE){e.removeClass("active");}d.removeClass("visible").hide();}else{if(a4!==Toolbar.COMMENT_MODE){e.addClass("active");
}var f=e.offset();var b=$("#AnnotationToolbar").offset();var c=e.outerHeight();d.css({left:(f.left-b.left)+"px",top:(f.top-b.top)+c+"px"});d.addClass("visible").show();
$(document).one("click",function(){d.removeClass("visible").hide();});}return false;};var aG=function(a){$("#CommentSub").removeClass("visible").hide();
var b=parseInt($(this).attr("val"));a1=b;if(a4!==Toolbar.COMMENT_MODE){by.setCurrentMode(Toolbar.COMMENT_MODE);$(by).trigger("commentModeActivated",[a1]);
}else{aA(a1);$(by).trigger("commentModeChanged",[a1]);}};var aN=1;var bl=function(){$(by).trigger("zoomOut");};var aK=function(){$(by).trigger("zoomIn");
};var a7=function(){var c=$("#ZoomSub");if(c.hasClass("visible")){c.removeClass("visible").hide();}else{var d=$("#ZoomSel").offset();var b=$("#ViewerToolbar").offset();
var a=$("#ZoomSel").outerHeight();c.css({left:(d.left)+"px",top:(d.top-b.top)+a+"px"});c.addClass("visible").show();$(document).one("click",function(){c.removeClass("visible").hide();
});}return false;};var bk=function(a){$("#ZoomSub").removeClass("visible").hide();av($(this).find("span").attr("value"));};var av=function(a){$(by).trigger("setZoom",[a]);
};var aW=function(a){$("#ZoomSel").attr("value",a);var b=$('#ZoomSub li span[value="'+$("#ZoomSel").attr("value")+'"]').text();$("#ZoomSel .zoomtext").text(b);
};var aL=function(b,a){a=parseInt(a);$('#TextToolSettings .swatch[value="'+a+'"]').append(bv);if(b){a3=a;by.newTextColor=bs[a3];$(by).trigger("setTextColor",[{index:a,hex:by.newTextColor}]);
}};var aR=function(b){$(this).blur();var d=$("#TextSizeSub");if(d.hasClass("visible")){d.removeClass("visible").hide();}else{var e=$(this).offset();var c=$("#AnnotationToolbar").offset();
var a=$(this).outerHeight();d.css({left:(e.left-c.left)+"px",top:(e.top-c.top)+a+"px"});d.addClass("visible").show();}};var aD=function(a){var b=$(a.target);
b=b.is("span")?b:b.find("span");$("#TextSizeSub").removeClass("visible").hide();bE(true,b.attr("value"));};var bE=function(b,c){c=parseInt(c);$("#TextSizeSel").attr("value",c);
var a=$('#TextSizeSub li span[value="'+c+'"]').text();$("#TextSizeSel").text(a);if(b){br=c;by.newTextSize=br;$(by).trigger("setTextSize",[by.newTextSize]);
}};var bB=function(a,b){b=parseInt(b);$("#TextBGBtn").toggleClass("white",b!==-1);if(a){bw=b;by.newTextBGColor=bw;$(by).trigger("setTextBGColor",[by.newTextBGColor]);
}};var az=function(a,b){b=parseInt(b);$('#DrawToolSettings .swatch[value="'+b+'"]').append(bv);if(a){be=b;by.newDrawColor=a5[be];$(by).trigger("setDrawColor",[{index:b,hex:by.newDrawColor}]);
}};var aJ="yellow";var aP=function(c,b){$('#HighlightToolSettings .swatch[value="0x'+b.toString(16).toUpperCase()+'"]').append(bv);var a=Highlight.colorLookup[b].colorClass;
aV.removeClass(aJ).addClass(a);aJ=a;if(c){by.newHighlightColor=b;$(by).trigger("setHighlightColor",[by.newHighlightColor]);}};var bn=function(b,c){var a=HighlightUtilities.getSelectionRange();
if(a){var d=c?"strikeoutRequested":"highlightRequested";$(by).trigger(d,[a,b]);return true;}else{return false;}};var aB=function(){$(by).trigger("pageUp");
};var aw=function(){$(by).trigger("pageDown");};var bi=function(f){if(EMBEDDED){$(by).trigger("exportRequested",[2]);}else{var e=$(this);e.blur();var d=$("#DownloadSub");
if(d.hasClass("visible")){d.removeClass("visible").hide();e.removeClass("open");}else{var h=e.offset();var b=$("#ViewerToolbar").offset();var a=e.outerHeight(),g=e.outerWidth();
var c=d.outerWidth();d.css({left:(h.left-b.left+g+8-c)+"px",top:(h.top-b.top+a-1)+"px"});e.addClass("open");setTimeout(function(){d.addClass("visible").show();
$(document).one("click",function(){d.removeClass("visible").hide();e.removeClass("open");});},0);}}};var aH=function(a){$("#DownloadButton").removeClass("open");
$("#DownloadSub").removeClass("visible").hide();var b=parseInt($(this).attr("value"));if(b!==0){aF("DLWait");}$(by).trigger("exportRequested",[b]);};var bc=null;
var aF=function(d,b,a,c){if(d=="DLSuccess"){if(b!==2){aS.dialog("close");return;}else{$("#DLSuccess a").attr("href",a);}}else{if(d=="DLAuthorize"){bc=c;
}}aS.find(".view").hide();$("#"+d).show();aS.dialog("open");};var ay=function(a){window.open(bc,"Google Authentication");setTimeout(bq,100);};var bq=function(){var a=window.location.hash;
if(a=="#authorized"){window.location.hash="";$(by).trigger("exportRequested",[2]);}else{if(a=="#failed"){window.location.hash="";aS.dialog("close");}else{setTimeout(bq,100);
}}};a0();};Toolbar.NONE_MODE=0;Toolbar.LAST_CURRENT_MODE=1;Toolbar.HIGHLIGHT_MODE=2;Toolbar.TEXTBOX_MODE=3;Toolbar.DRAWING_MODE=4;Toolbar.STRIKEOUT_MODE=5;
Toolbar.COMMENT_MODE=6;Toolbar.ANCHOR_COMMENT_MODE=10;Toolbar.AREA_COMMENT_MODE=11;Toolbar.TEXT_COMMENT_MODE=12;var Anchor=function(Z,am,L,S,W,aj,O){var y=this;
if(arguments.length===7){this.id=Z!=null?Z:Utilities.generateUUID();this.canvas=am;this.pageNumber=L;this.x=S;this.y=W;this.author=aj;this.comment=null;
this.isReadOnly=O;}else{this.id=Utilities.generateUUID();this.canvas=null;this.pageNumber=-1;this.x=-1;this.y=-1;this.author=null;this.comment=null;this.isReadOnly=false;
}this.type=AnnoTypes.ANCHOR;var Q=function(){ac=y.canvas.set();aa=y.canvas.path();ai=y.canvas.path();ab=y.canvas.path();ai.insertBefore(aa);ab.insertBefore(ai);
ac.push(aa,ai,ab);y.x=Math.round(y.x);y.y=Math.round(y.y);an=y.x*DocumentManager.DRAWSCALE;ap=y.y*DocumentManager.DRAWSCALE;T();if(!y.isReadOnly){N();}X(Anchor.NORMAL);
};this.focus=function(a){if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation!=this){AnnotationManager.activeAnnotation.defocus();
}if(x!==Anchor.ACTIVE){X(Anchor.ACTIVE);AnnotationManager.activeAnnotation=this;}if(a){$(y).trigger("focused");}};this.defocus=function(a){if(AnnotationManager.activeAnnotation!==this){return;
}if(x===Anchor.ACTIVE){AnnotationManager.activeAnnotation=null;X(Anchor.NORMAL);}if(a){$(y).trigger("defocused");}};this.scale=function(){var a=DocumentManager.DRAWSCALE;
ac.scale(a,a,0,0);an=y.x*a;ap=y.y*a;R(an,ap);};this.destroy=function(){ah(false);ac.remove();};this.deleteSelf=function(){var a=$(aa.node).closest(".layer.anno");
a.removeClass("drag_cursor_open").removeClass("drag_cursor_closed");$(y).trigger("deleteRequested");};this.getAnnoLocationInfo=function(){return aa.getBBox().y;
};this.show=function(){ac.show();};this.hide=function(){ac.hide();};this.getLinePosition=function(){return[y.x+aq/2,y.y-aq];};this.setPosition=function(b,a){y.x=Math.round(b);
y.y=Math.round(a);y.scale();};this.setHover=function(a){if(x!=Area.ACTIVE){if(a){X(Anchor.HOVER);}else{X(Anchor.NORMAL);}}};var ac;var ak;var an,ap;var aa,ai,ab;
var ae=2;var U=12;var aq=6;var x;var af=false,Y=false;var V="#DB0000";var ao="#A90101";var T=function(){var b=aq*DocumentManager.DRAWSCALE;var a=aq*DocumentManager.DRAWSCALE;
var c=(aq/2)*DocumentManager.DRAWSCALE;ak=[["M",an,ap],["l",-b/2,-c],["l",0,-a],["l",b,0],["l",0,a],["z"]];ac.attr("path",ak);aa.attr({"stroke-width":0,fill:V});
ai.attr({"stroke-width":ae,stroke:"#ff0","stroke-opacity":0});ab.attr({"stroke-width":U,stroke:"#000","stroke-opacity":0.001});Utilities.addSVGClasses(aa.node,["anchornode","vector"]);
Utilities.addSVGClasses(ai.node,["anchornode","vector"]);Utilities.addSVGClasses(ab.node,["anchornode","vector"]);$(aa.node).tipsy({html:true,voffset:2,hoffset:-10,gravity:"sw",title:ag,trigger:"manual"});
};var R=function(a,b){var e=aq*DocumentManager.DRAWSCALE;var c=aq*DocumentManager.DRAWSCALE;var d=(aq/2)*DocumentManager.DRAWSCALE;ak=[["M",a,b],["l",-e/2,-d],["l",0,-c],["l",e,0],["l",0,c],["z"]];
ac.attr("path",ak);};var M=function(f,g,a,b,d){if(!af){$(y).trigger("dragStarted");if(y.comment){y.comment.setLineVisibility(false);}af=true;}var c,e;c=an+f;
e=ap+g;R(c,e);};var P=function(b){var a=aa.attr("path");an=a[0][1];ap=a[0][2];y.x=Math.round(an/DocumentManager.DRAWSCALE);y.y=Math.round(ap/DocumentManager.DRAWSCALE);
if(y.comment){y.comment.setLineVisibility(true);}$(y).trigger("dragStopped");$(y).trigger("annotationUpdated");};var ad=function(a,b,c){if(c.button==2||c.metaKey===true){var d={annotation:y,x:a,y:b};
$(y).trigger("annotationContextMenu",[d]);$(document).one("contextmenu",function(){return false;});}else{af=false;Y=true;var e=$(this.node).closest(".layer.anno");
e.addClass("drag_cursor_close");}ah(false);ar=true;c.stopPropagation();};var al=function(b){if(b.button==2||b.metaKey===true){}else{Y=false;if(af){af=false;
P(b);}else{if(x!==Anchor.ACTIVE){y.focus(true);}}}setTimeout(function(){ar=false;},1000);var a=$(this.node).closest(".layer.anno");a.removeClass("drag_cursor_close");
b.stopPropagation();};var ag=function(){if(y.comment){return y.comment.getTooltipText();}return"";};var ar=false;var ah=function(b){var a=(!ar&&b)?"show":"hide";
$(aa.node).tipsy(a);};var N=function(){ac.mouseover(function(){if(x==Anchor.ACTIVE){ah(true);}else{if(!AnnotationManager.isDragging){X(Anchor.HOVER);ah(true);
if(y.comment){y.comment.hover(true);}}}var a=$(this.node).closest(".layer.anno");a.addClass("drag_cursor_open");});ac.mouseout(function(){if(x==Anchor.ACTIVE){ah(false);
}else{X(Anchor.NORMAL);ah(false);if(y.comment){y.comment.hover(false);}}var a=$(this.node).closest(".layer.anno");a.removeClass("drag_cursor_open");});
aa.drag(M,ad,al);ai.drag(M,ad,al);ab.drag(M,ad,al);};var X=function(a){if(a==x){return;}if(Y){return;}x=a;switch(a){case Anchor.NORMAL:aa.attr("fill",V);
break;case Anchor.ACTIVE:aa.attr("fill",ao);break;case Anchor.HOVER:aa.attr("fill",ao);break;}};Q();};Anchor.NORMAL=1;Anchor.ACTIVE=2;Anchor.HOVER=3;var Area=function(at,aN,aI,ap,aq,a2,aY,aL,aG,aD){var aM=this;
if(arguments.length===10){this.id=at!=null?at:Utilities.generateUUID();this.canvas=aN;this.pageNumber=aI;this.x=ap;this.y=aq;this.width=a2;this.height=aY;
this.author=aL;this.comment=null;this.isReadOnly=aG;}else{this.id=Utilities.generateUUID();this.canvas=null;this.pageNumber=-1;this.x=-1;this.y=-1;this.width=-1;
this.height=-1;this.author=null;this.comment=null;this.isReadOnly=aG;}this.type=AnnoTypes.AREA;var ah=function(b){aw=aM.canvas.set();ax=aM.canvas.set();
ao=aM.canvas.rect();an=aM.canvas.rect();ai=aM.canvas.rect();an.insertBefore(ao);ai.insertBefore(an);ax.push(ao,an,ai);aM.x=Math.round(aM.x);aM.y=Math.round(aM.y);
aM.width=Math.round(aM.width);aM.height=Math.round(aM.height);y=aM.x*DocumentManager.DRAWSCALE;af=aM.y*DocumentManager.DRAWSCALE;aP=aM.width*DocumentManager.DRAWSCALE;
a1=aM.height*DocumentManager.DRAWSCALE;x();if(!aG){am();}aj(Area.NORMAL);if(b==true){aH=false;var c=function(d){var f=$(ao.node).closest(".layer.anno").offset();
var e=(d.pageX-f.left)-(y+aP);var g=(d.pageY-f.top)-(af+a1);al(e,g,null,null,null);d.stopPropagation();d.preventDefault();};var a=function(d){if(!ak){aM.deleteSelf();
}else{aE(d);}$(ao.node).closest(".page-outer").unbind("mousemove",c).unbind("mouseup",a);};$(ao.node).closest(".page-outer").bind("mousemove",c).bind("mouseup",a);
ak=false;aF=true;aO={left:false,top:false};}};this.focus=function(a){if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation!=this){AnnotationManager.activeAnnotation.defocus();
}if(aB!==Area.ACTIVE){aj(Area.ACTIVE,true);AnnotationManager.activeAnnotation=this;}if(a){$(aM).trigger("focused");}};this.defocus=function(a){if(AnnotationManager.activeAnnotation!==this){return;
}if(aB===Area.ACTIVE){AnnotationManager.activeAnnotation=null;aj(Area.NORMAL);}$("#ZoomSel").focus();if(a){$(aM).trigger("defocused");}};this.scale=function(){var a=DocumentManager.DRAWSCALE;
ax.scale(a,a,0,0);y=aM.x*a;af=aM.y*a;aP=aM.width*a;a1=aM.height*a;aU(y,af,aP,a1);};this.destroy=function(){aC(false);aw.remove();ax.remove();};this.deleteSelf=function(){var a=$(ao.node).closest(".layer.anno");
a.removeClass("drag_cursor_open").removeClass("drag_cursor_closed");$(aM).trigger("deleteRequested");};this.getAnnoLocationInfo=function(){return ao.getBBox().y;
};this.show=function(){aw.show();ax.show();};this.hide=function(){aw.hide();ax.hide();};this.getLinePosition=function(){return[aM.x+aM.width+av,aM.y+8];
};this.setPositionAndDimensions=function(c,d,b,a){aM.x=Math.round(c);aM.y=Math.round(d);aM.width=Math.round(b);aM.height=Math.round(a);aM.scale();};this.setHover=function(a){if(aB!=Area.ACTIVE){if(a){aj(Area.HOVER,false);
}else{aj(Area.NORMAL);}}};var ax;var ao,an,ai;var aw;var aJ,aS,aW,aZ;var a0=4;var av=1.5;var aA=4;var ar=6;var az=1;var aO;var aH=null;var aB;var ak=false,aF=false;
var y,af,aP,a1;var ay="#DB0000";var au="#A90101";var ad="#979797";var aQ="#DAE9FC";var x=function(){ax.attr({x:y,y:af,width:aP,height:a1});ao.attr({stroke:ay,"stroke-width":av*DocumentManager.DRAWSCALE});
an.attr({stroke:"#ff0","stroke-opacity":0,"stroke-width":aA*DocumentManager.DRAWSCALE});ai.attr({stroke:"#000","stroke-opacity":0.001,"stroke-width":ar*DocumentManager.DRAWSCALE});
Utilities.addSVGClasses(ao.node,["areanode","vector"]);Utilities.addSVGClasses(an.node,["areanode","vector"]);Utilities.addSVGClasses(ai.node,["areanode","vector"]);
ae();$(ao.node).tipsy({html:true,voffset:2,hoffset:-5,gravity:"sw",title:aT,trigger:"manual"});};var aU=function(d,a,c,e){var b=a0*DocumentManager.DRAWSCALE;
ax.attr({x:d,y:a,width:c,height:e});aJ.attr({x:d-b/2,y:a-b/2,width:b,height:b});aS.attr({x:d+c-b/2,y:a-b/2,width:b,height:b});aW.attr({x:d-b/2,y:a+e-b/2,width:b,height:b});
aZ.attr({x:d+c-b/2,y:a+e-b/2,width:b,height:b});ao.attr({"stroke-width":av*DocumentManager.DRAWSCALE});an.attr({"stroke-width":aA*DocumentManager.DRAWSCALE});
ai.attr({"stroke-width":ar*DocumentManager.DRAWSCALE});aw.attr({stroke:ad,fill:aQ});};var ae=function(){var a=a0*DocumentManager.DRAWSCALE;aJ=aM.canvas.rect(y-a/2,af-a/2,a,a);
aS=aM.canvas.rect(y+aP-a/2,af-a/2,a,a);aW=aM.canvas.rect(y-a/2,af+a1-a/2,a,a);aZ=aM.canvas.rect(y+aP-a/2,af+a1-a/2,a,a);aw.push(aJ,aS,aW,aZ);aw.attr({stroke:ad,fill:aQ,"stroke-width":az});
Utilities.addSVGClasses(aJ.node,["arearesizenode","top","left","vector"]);Utilities.addSVGClasses(aS.node,["arearesizenode","top","right","vector"]);Utilities.addSVGClasses(aW.node,["arearesizenode","bottom","left","vector"]);
Utilities.addSVGClasses(aZ.node,["arearesizenode","bottom","right","vector"]);aw.hide();};var aK=function(c,d,e,a,b){if(!ak){$(aM).trigger("dragStarted");
if(aH==null){aH=false;}if(aM.comment){aM.comment.setLineVisibility(false);}ak=true;}var e,a;e=y+c;a=af+d;aU(e,a,aP,a1);};var aV=function(a){aH=null;y=ao.attr("x");
af=ao.attr("y");aM.x=Math.round(y/DocumentManager.DRAWSCALE);aM.y=Math.round(af/DocumentManager.DRAWSCALE);if(aM.comment){aM.comment.setLineVisibility(true);
}$(aM).trigger("dragStopped");$(aM).trigger("annotationUpdated");};var al=function(a,b,e,g,h){if(!ak){$(aM).trigger("dragStarted");if(aH==null){aH=true;
}if(aM.comment){aM.comment.setLineVisibility(false);}ak=true;}var d,f,i,c;if(aO.left){d=y+a;i=aP-a;}else{d=y;i=aP+a;}if(aO.top){f=af+b;c=a1-b;}else{f=af;
c=a1+b;}if(i<0){i=-i;d-=i;}if(c<0){c=-c;f-=c;}aU(d,f,i,c);};var aX=function(a){aO=null;aH=null;aP=ao.attr("width");a1=ao.attr("height");y=ao.attr("x");
af=ao.attr("y");aM.x=Math.round(y/DocumentManager.DRAWSCALE);aM.y=Math.round(af/DocumentManager.DRAWSCALE);aM.width=Math.round(aP/DocumentManager.DRAWSCALE);
aM.height=Math.round(a1/DocumentManager.DRAWSCALE);if(aM.comment){aM.comment.setLineVisibility(true);}$(aM).trigger("dragStopped");$(aM).trigger("annotationUpdated");
};var ag=function(e,a,b){if(b.button==2||b.metaKey===true){var c={annotation:aM,x:e,y:a};$(aM).trigger("annotationContextMenu",[c]);$(document).one("contextmenu",function(){return false;
});}else{ak=false;aF=true;if(Utilities.hasSVGClass(this.node,"arearesizenode")){aO={left:Utilities.hasSVGClass(this.node,"left"),top:Utilities.hasSVGClass(this.node,"top")};
}else{var d=$(this.node).closest(".layer.anno");d.addClass("drag_cursor_close");}}aC(false);aR=true;b.stopPropagation();};var aE=function(b){if(b.button==2||b.metaKey===true){}else{aF=false;
if(ak){ak=false;if(aO!=null){aX(b);var a=$(this.node).closest(".layer.anno");a.removeClass("nw_resize_cursor").removeClass("ne_resize_cursor");aM.focus(true);
}else{aV(b);}}else{if(aB!==Area.ACTIVE){aM.focus(true);}}}setTimeout(function(){aR=false;},1000);var a=$(this.node).closest(".layer.anno");a.removeClass("drag_cursor_close");
b.stopPropagation();};var aT=function(){if(aM.comment){return aM.comment.getTooltipText();}return"";};var aR=false;var aC=function(b){var a=(!aR&&b)?"show":"hide";
$(ao.node).tipsy(a);};var am=function(){var b=function(g){var d=Utilities.hasSVGClass(g,"left");var e=Utilities.hasSVGClass(g,"top");var f="nw_resize_cursor";
if((d&&!e)||(!d&&e)){f="ne_resize_cursor";}return f;};var a=function(d){if(!AnnotationManager.isDragging){if(aB==Area.ACTIVE){aC(true);}else{aj(Area.HOVER,true);
aC(true);if(aM.comment){aM.comment.hover(true);}}var f=$(this.node).closest(".layer.anno");if(Utilities.hasSVGClass(this.node,"arearesizenode")){var e=b(this.node);
f.addClass(e);}else{f.addClass("drag_cursor_open");}}};var c=function(){if(!aF){if(aB==Area.ACTIVE){aC(false);}else{aj(Area.NORMAL);aC(false);if(aM.comment){aM.comment.hover(false);
}}var d=$(this.node).closest(".layer.anno");if(Utilities.hasSVGClass(this.node,"arearesizenode")){d.removeClass("nw_resize_cursor").removeClass("ne_resize_cursor");
}else{d.removeClass("drag_cursor_open").removeClass("drag_cursor_closed");}}};ax.mouseover(a);ax.mouseout(c);aw.mouseover(a);aw.mouseout(c);ao.drag(aK,ag,aE);
an.drag(aK,ag,aE);ai.drag(aK,ag,aE);aJ.drag(al,ag,aE);aS.drag(al,ag,aE);aW.drag(al,ag,aE);aZ.drag(al,ag,aE);};var aj=function(b,a){if(b==aB){return;}if(aF){return;
}aB=b;switch(b){case Area.NORMAL:ao.attr("stroke",ay);if(aH!=true){aw.hide();}break;case Area.ACTIVE:ao.attr("stroke",au);if(a&&aH!=false){aw.show();}break;
case Area.HOVER:ao.attr("stroke",au);if(a&&aH!=false){aw.show();}break;}};ah(aD);};Area.NORMAL=1;Area.ACTIVE=2;Area.HOVER=3;var Comment=function(Z,al,ap,ak,ab){var ao=this;
if(arguments.length===5){this.id=Z!=null?Z:Utilities.generateUUID();this.annotation=al;this.canvas=ap;this.isReadOnly=ak;}else{this.id=Utilities.generateUUID();
this.annotation=null;this.canvas=null;this.isReadOnly=false;}var R=function(){ar=$("#page"+(ao.annotation.pageNumber-1)).find(".comment-pane");au=$("#page"+(ao.annotation.pageNumber-1)).find(".layer.commentline");
P=au.offset();M=ao.getYPosition();K=ao.canvas.set();at=ao.canvas.path();am=ao.canvas.path();am.insertBefore(am);K.push(at,am);Utilities.addSVGClasses(at.node,["linenode","vector"]);
Utilities.addSVGClasses(am.node,["linenode","vector"]);at.attr({stroke:W,"stroke-width":aa,"stroke-dasharray":"."});am.attr({stroke:"#000","stroke-opacity":0.001,"stroke-width":X});
N();V();S(Comment.NORMAL);};this.focusReply=function(b){var a=b?b:T[T.length-1];a.focus(true,true);};this.getYPosition=function(){var a=ao.annotation.getLinePosition()[1];
return a;};this.getViewPosition=function(){return M;};this.setViewPosition=function(a){M=a;ai();};this.getHeight=function(){return ac.find(".commentbody").outerHeight();
};this.getDOMElement=function(){return ac;};this.getNumReplies=function(){return T.length;};this.getMaxOrderIndex=function(){return T.length>0?T[T.length-1].orderIndex:-1;
};this.deleteAllReplies=function(){var a=T.slice();$.each(a,function(b,c){c.deleteSelf();});if(al){al.deleteSelf();}};this.focus=function(){if(AnnotationManager.activeComment){AnnotationManager.activeComment.defocus();
}if(ah!==Comment.ACTIVE){S(Comment.ACTIVE);AnnotationManager.activeComment=ao;}$(ao).trigger("commentFocused");};this.defocus=function(d){if(AnnotationManager.activeComment!==this){return;
}if(ah===Comment.ACTIVE){AnnotationManager.activeComment=null;S(Comment.NORMAL);for(var b=T.length-1;b>=0;--b){var a=T[b];var c=a.getText();if(c==""){a.deleteSelf();
}}if(d){$("#Dummy").focus();}$(ao).trigger("commentDefocused");}};this.hover=function(a){if(!ao.isReadOnly){if(ah==Comment.ACTIVE){}else{if(a){S(Comment.HOVER);
}else{S(Comment.NORMAL);}if(ao.annotation&&ao.annotation.setHover){ao.annotation.setHover(a);}}}};this.show=function(){ac.show();Y();K.show();};this.hide=function(){ac.hide();
K.hide();};this.destroy=function(){ae();ac.remove();K.remove();};this.addCommentReply=function(b){b.comment=ao;var a=b.getDOMObject();if(T.length>0){a.addClass("sub");
}a.appendTo(ac.find(".commentbody")).show();T.push(b);$(b).bind({focused:function(c){if(ah!==Comment.ACTIVE){ao.focus();}},defocused:function(c){if(ah===Comment.ACTIVE){ao.defocus(false);
}}});return b;};this.destroyCommentReply=function(a){var b=$.inArray(a,T);if(b!=-1){a.destroy();T.splice(b,1);if(b===0&&T.length>0){T[0].getDOMObject().removeClass("sub");
}}};this.setLineVisibility=function(a){a?K.show():K.hide();};this.getTooltipText=function(){var c=null,a=T.length,b;if(a>0){b=T[0];c=b.authorName+": "+b.content;
}if(a>1){c+="<br>("+(a-1)+(a==2?" reply)":" replies)");}return c;};var ac;var ah;var T=[];var M;var ar;var au;var P;var K,at,am;var U;var O;var aa=2;var X=6;
var aq=7;var W="#E5B438";var ad="#E5B438";var N=function(){ac=$('<div class="comment normal"><div class="commentbody"></div><div class="commentmenu"></div></div>');
var c=ac.find(".commentmenu");var d=$('<span class="menuitem reply">Reply</span>');d.appendTo(c);var b=$('<span class="menuitem delete">Delete</span>');
b.appendTo(c);var a=(M*DocumentManager.DRAWSCALE)-aq;if(ab){ac.addClass("owner");}ac.appendTo(ar).css({top:a}).show();O=ac.position().left;Y();};var Y=function(){if(au.length>0){var d=ao.annotation.getLinePosition();
var b=[ac.offset().left-P.left,(ac.offset().top-P.top)+aq];var e=[d[0]*DocumentManager.DRAWSCALE,d[1]*DocumentManager.DRAWSCALE];var c=[b[0]-3,b[1]];var a=[b[0]-O+5,e[1]];
U=[["M",b[0],b[1]],["L",c[0],c[1]],["L",a[0],a[1]],["L",e[0],e[1]]];K.attr("path",U);}};var ai=function(){var a=(M*DocumentManager.DRAWSCALE)-aq;ac.css({top:a});
Y();};var aj=function(a){ao.hover(true);};var af=function(a){ao.hover(false);};var Q=function(a){a.stopPropagation();return false;};var L=function(a){a.stopPropagation();
};var an=function(a){$(ao).trigger("addReplyRequested");a.stopPropagation();return false;};var ag=function(a){if(ab){ao.defocus();$(ao).trigger("commentDeleteRequested");
}a.stopPropagation();return false;};var V=function(){ac.bind("mousedown",Q).bind("mouseup",L).bind("mouseenter",aj).bind("mouseleave",af);ac.find(".menuitem.reply").bind("click",an);
ac.find(".menuitem.delete").bind("click",ag);};var ae=function(){ac.unbind("mousedown",Q).unbind("mouseup",L).unbind("mouseenter",aj).unbind("mouseleave",af);
ac.find(".menuitem.reply").unbind("click",an);ac.find(".menuitem.delete").unbind("click",ag);};var S=function(a){if(a==ah){return;}ah=a;switch(a){case Comment.NORMAL:ac.removeClass("active").addClass("normal");
at.attr({stroke:W,"stroke-dasharray":"."});break;case Comment.ACTIVE:ac.removeClass("normal").addClass("active");at.attr({stroke:ad,"stroke-dasharray":""});
break;case Comment.HOVER:ac.removeClass("normal").addClass("active");at.attr({stroke:ad,"stroke-dasharray":""});break;}};R();};Comment.NORMAL=1;Comment.ACTIVE=2;
Comment.HOVER=3;var CommentReply=function(J,I,A,G,F,N){var K=this;var L="anonymous",O=$.browser.msie?"":": ";if(arguments.length===6){this.id=J!=null?J:Utilities.generateUUID();
this.authorId=I;this.authorName=A?A:L;this.content=G;this.orderIndex=F;this.comment=null;this.isReadOnly=N;}else{this.id=Utilities.generateUUID();this.authorId=null;
this.authorName="";this.content="";this.orderIndex=-1;this.comment=null;this.isReadOnly=true;}var E=function(){var a=$.getMarkupText(K.content,true);D=$('<div class="commentreply"><span class="replyauthor">'+K.authorName+O+'</span><div class="replycontent" spellcheck="false">'+a+"&#8203;</div></div>");
R=D.find(".replycontent");if(!K.isReadOnly){R.attr("contentEditable",true);}B=D.outerHeight();C();};this.focus=function(b,a){if(b){H();}if(a){$(K).trigger("focused");
}};this.defocus=function(b){var a=V();if(a==""){K.deleteSelf();}else{R.removeClass("editmode");if(b){$(K).trigger("defocused");}}};this.deleteSelf=function(){$(K).trigger("replyDeleteRequested");
};this.destroy=function(){z();D.remove();};this.updateAuthorName=function(a){a=a?a:L;D.find(".replyauthor").html(a+O);};this.getDOMObject=function(){return D;
};this.getText=function(){return V();};this.setContent=function(b){K.content=b;var a=$.getMarkupText(K.content,true);R.html(a);};var D,R,B;var H=function(){if(!K.isReadOnly){}R.focus();
R.addClass("editmode");};var U=function(a){};var y=function(a){$(K).trigger("focused");};var P=function(a){a.stopPropagation();};var T=function(a){R.focus();
if(!K.isReadOnly){K.focus(true,true);}a.stopPropagation();};var Q=function(b){var a=D.outerHeight();if(a!=B){B=a;$(K).trigger("heightChanged");}clearTimeout(S);
S=setTimeout(M,500);};var C=function(){D.bind("mousedown",P).bind("mouseup",T).bind("blur keyup paste",Q);R.bind("keypress",Utilities.onKeyPressed).bind("blur",U);
};var z=function(){D.unbind("mousedown",P).unbind("mouseup",T).unbind("blur keyup paste",Q);R.unbind("blur",U).unbind("focus",y).unbind("mousedown",P).unbind("keypress",Utilities.onKeyPressed).unbind("mousedown",function(a){a.stopPropagation();
});};var V=function(){var a=$.trim(R.getPreText());return a?a.replace(/\u200B/g,""):a;};var S;var M=function(){var a=V();if(K.content!=a){K.content=Utilities.trima(a.escapeHTML());
$(K).trigger("commentUpdated");}};E();};var Drawing=function(aH,a4,aZ,az,aB,ar,aN,a2,aV,aR){var a3=this;if(arguments.length===10){this.id=aH!=null?aH:Utilities.generateUUID();
this.canvas=a4;this.pageNumber=aZ;this.x=az;this.y=aB;this.lines=ar;this.color=aN;this.author=a2;this.isReadOnly=aV;}else{this.id=Utilities.generateUUID();
this.canvas=null;this.pageNumber=-1;this.x=-1;this.y=-1;this.lines="[]";this.color=-1;this.author=null;this.isReadOnly=false;}this.type=AnnoTypes.DRAWING;
var al=function(a){aF=a3.canvas.set();ay=a3.canvas.path();aw=a3.canvas.path();am=a3.canvas.path();aw.insertBefore(ay);am.insertBefore(aw);aF.push(am,aw,ay);
au=$('<div class="boundingbox"></div>');$(ay.node).closest(".layer.anno").append(au);a3.x=Math.round(a3.x);a3.y=Math.round(a3.y);ag=a3.x*DocumentManager.DRAWSCALE;
ai=a3.y*DocumentManager.DRAWSCALE;aJ();if(!aV){av();}an(Drawing.NORMAL);if(a){aM(a3.x,a3.y);}};this.focus=function(a){if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation!=this){AnnotationManager.activeAnnotation.defocus();
}if(aQ!==Drawing.ACTIVE){an(Drawing.ACTIVE);AnnotationManager.activeAnnotation=this;}if(a){$(a3).trigger("focused");}};this.defocus=function(a){if(AnnotationManager.activeAnnotation!==this){return;
}if(aQ===Drawing.ACTIVE){AnnotationManager.activeAnnotation=null;an(Drawing.NORMAL);}if(a){$(a3).trigger("defocused");}};this.destroy=function(){aF.remove();
au.remove();};this.deleteSelf=function(){var a=$(ay.node).closest(".layer.anno");a.removeClass("drag_cursor_open").removeClass("drag_cursor_closed");$(a3).trigger("deleteRequested");
};this.scale=function(){ag=a3.x*DocumentManager.DRAWSCALE;ai=a3.y*DocumentManager.DRAWSCALE;aW=ax(aX);a0=aY(aW);a6(ag,ai);ay.attr("stroke-width",aL*DocumentManager.DRAWSCALE);
aw.attr("stroke-width",aA*DocumentManager.DRAWSCALE);am.attr("stroke-width",aD*DocumentManager.DRAWSCALE);};this.setColor=function(a){if(a===a3.color){return;
}a3.color=a;ay.attr("stroke",Utilities.intToColorString(a3.color));if(aq){$(a3).trigger("annotationUpdated");}};this.getAnnoLocationInfo=function(){return ay.getBBox().y;
};this.show=function(){aF.show();};this.hide=function(){aF.hide();};this.addLine=function(b,a){aM(b,a);};this.endDrawing=function(){am.attr({"stroke-width":aD*DocumentManager.DRAWSCALE});
aw.attr({"stroke-width":aA*DocumentManager.DRAWSCALE});aw.attr("stroke-opacity",1);setTimeout(function(){aw.attr("stroke-opacity",0);},300);ah=false;};
var aq=true;this.toggleUpdates=function(a){aq=a===true;};this.setPosition=function(b,a){a3.x=Math.round(b);a3.y=Math.round(a);ag=a3.x*DocumentManager.DRAWSCALE;
ai=a3.y*DocumentManager.DRAWSCALE;a6(ag,ai);};this.setLines=function(a){a3.lines=a;aJ();};var aX=[];var aW=[];var a0=[];var aF;var au;var ay,aw,am;var aL=1;
var aA=4;var aD=10;var aj=1;var y;var a8;var aQ;var ap=false,aT=false;var ag,ai;var aU=null;var aC=null;var ah;var aJ=function(){ay.attr({stroke:Utilities.intToColorString(a3.color),"stroke-width":aL*DocumentManager.DRAWSCALE});
aw.attr({stroke:"#FF0","stroke-opacity":0,"stroke-width":aA*DocumentManager.DRAWSCALE});am.attr({stroke:"#000","stroke-opacity":0.001,"stroke-width":aD*DocumentManager.DRAWSCALE});
aF.attr({"stroke-linecap":"round","stroke-linejoin":"round"});Utilities.addSVGClasses(ay.node,["drawingnode","vector"]);Utilities.addSVGClasses(aw.node,["drawingnode","vector"]);
Utilities.addSVGClasses(am.node,["drawingnode","vector"]);aX=aS(a3.lines);if(aX.length>0){aW=ax(aX);a0=aY(aW);var a=[["M",ag,ai]].concat(a0);aF.attr("path",a);
}};var a6=function(c,a){var b=[["M",c,a]].concat(a0);aF.attr("path",b);ay.attr({"stroke-width":aL*DocumentManager.DRAWSCALE});aw.attr({"stroke-width":aA*DocumentManager.DRAWSCALE});
am.attr({"stroke-width":aD*DocumentManager.DRAWSCALE});};var x=function(a){if(a){var f=10;var e=ay.getBBox();if(e){var b=e.x-f;var d=e.y-f;var g=e.width+(2*f);
var c=e.height+(2*f);au.css({top:d,left:b,width:g,height:c});au.show();}}else{au.hide();}};var aM=function(b,a){ap=false;ah=true;aU=new Array();aU[0]=["M",b*DocumentManager.DRAWSCALE,a*DocumentManager.DRAWSCALE];
aC=a3.canvas.path(aU);aC.attr({stroke:Utilities.intToColorString(a3.color),"stroke-width":aL*DocumentManager.DRAWSCALE});$(ay.node).closest(".page-outer").bind("mousemove",aK).bind("mouseup",aO);
aw.attr({"stroke-width":aL*DocumentManager.DRAWSCALE});am.attr({"stroke-width":aL*DocumentManager.DRAWSCALE});y=$(ay.node).closest(".layer.anno").offset();
};var aO=function(b){$(ay.node).closest(".page-outer").unbind("mousemove",aK).unbind("mouseup",aO);if(ap){var a=aC.attr("path");var c=aE(a);aX=aX.concat(c);
aW=ax(aX);a0=aY(aW);a3.lines=aI(aX);a6(ag,ai);am.attr({"stroke-width":aL*DocumentManager.DRAWSCALE});aw.attr({"stroke-width":aL*DocumentManager.DRAWSCALE});
aC.remove();$(a3).trigger("dragStopped");$(a3).trigger("annotationUpdated");}$(a3).trigger("drawStopped",[ap]);ap=false;aU=null;aC=null;b.stopPropagation();
};var aK=function(b){if(!ap){ap=true;$(a3).trigger("drawStarted");}var c=(b.pageX-y.left);var a=(b.pageY-y.top);ao(c,a);b.stopPropagation();b.preventDefault();
};var ao=function(b,a){if(aU.length==1){aU[aU.length]=["L",b,a];}else{aU[aU.length]=[b,a];}aC.attr({path:aU});};var a1=function(a,b,c,d,e){if(!ap){$(a3).trigger("dragStarted");
ap=true;}var c,d;c=ag+a;d=ai+b;a6(c,d);x(true);return false;};var a7=function(g){var e=DocumentManager.DRAWSCALE;aW=ay.attr("path");var c=aW[0][1];var f=aW[0][2];
var d=c-ag;var b=f-ai;ag=c;ai=f;aX=aP(aX,d/e,b/e);a3.x=Math.round(ag/DocumentManager.DRAWSCALE);a3.y=Math.round(ai/DocumentManager.DRAWSCALE);a0=aY(aW);
a3.lines=aI(aX);var a=[["M",ag,ai]].concat(a0);aF.attr("path",a);$(a3).trigger("dragStopped");$(a3).trigger("annotationUpdated");return false;};var ak=function(b,d,f,a,c,e){if(f.button==2||f.metaKey===true){var g={annotation:a3,x:b,y:d};
$(a3).trigger("annotationContextMenu",[g]);$(document).one("contextmenu",function(){return false;});}else{ap=false;aT=true;var h=$(this.node).closest(".layer.anno");
h.addClass("drag_cursor_close");}f.stopPropagation();return false;};var aG=function(b){if(b.button==2||b.metaKey===true){}else{aT=false;if(ap){ap=false;
a7(b);}else{if(aQ!==Drawing.ACTIVE){a3.focus(true);}}}var a=$(this.node).closest(".layer.anno");a.removeClass("drag_cursor_close");b.stopPropagation();
return false;};var a5=function(a){switch(a.keyCode){case 46:a3.deleteSelf();break;}};var av=function(){aF.mouseover(function(){if(aQ==Drawing.ACTIVE){}else{if(!AnnotationManager.isDragging){an(Drawing.HOVER);
}}var a=$(this.node).closest(".layer.anno");a.addClass("drag_cursor_open");});aF.mouseout(function(){if(aQ==Drawing.ACTIVE){}else{an(Drawing.NORMAL);}var a=$(this.node).closest(".layer.anno");
a.removeClass("drag_cursor_open");});ay.drag(a1,ak,aG);aw.drag(a1,ak,aG);am.drag(a1,ak,aG);};var at=function(a){if(a){$(document).bind("keydown",a5);}else{$(document).unbind("keydown",a5);
}};var aI=function(f){var g="[[";var a=false;for(var h=0;h<f.length;++h){var b=f[h];var e=b[0];if(e=="M"){if(a){g=g.slice(0,g.length-1);g+="],[";}var c=Math.round(b[1]-a3.x);
var d=Math.round(b[2]-a3.y);g+=c+","+d+",";}else{if(e=="L"){a=true;var c=Math.round(b[1]-a3.x);var d=Math.round(b[2]-a3.y);g+=c+","+d+",";}else{a=true;
var c=Math.round(b[0]-a3.x);var d=Math.round(b[1]-a3.y);g+=c+","+d+",";}}}g=g.slice(0,g.length-1)+"]]";return g;};var aS=function(f){var e=JSON.parse(f);
var b=[];for(var c=0;c<e.length;++c){var a=e[c];b.push(["M",a3.x+a[0],a3.y+a[1]]);for(var d=2;d<a.length;d+=2){b.push(["L",a3.x+a[d],a3.y+a[d+1]]);}}return b;
};var aY=function(c){var b=[];var e=ag;var g=ai;for(var h=0;h<c.length;++h){var a=c[h];var i=a[0];if(i=="M"){var f=a[1]-e;var d=a[2]-g;b.push(["m",f,d]);
e=a[1];g=a[2];}else{if(i=="m"){var f=a[1];var d=a[2];b.push(["m",f,d]);e+=a[1];g+=a[2];}else{if(i=="L"){var f=a[1]-e;var d=a[2]-g;b.push(["l",f,d]);e=a[1];
g=a[2];}else{if(i=="l"){var f=a[1];var d=a[2];b.push(["l",f,d]);e+=a[1];g+=a[2];}else{var f=a[0]-e;var d=a[1]-g;b.push(["l",f,d]);e=a[0];g=a[1];}}}}}return b;
};var ax=function(c){var d=[];var b=DocumentManager.DRAWSCALE;for(var f=0;f<c.length;++f){var a=c[f];var e=[];if(a.length==2){e.push(a[0]*b);e.push(a[1]*b);
d.push(e);}else{e.push(a[0]);e.push(a[1]*b);e.push(a[2]*b);d.push(e);}}return d;};var aE=function(c){var f=[];var b=DocumentManager.DRAWSCALE;for(var e=0;
e<c.length;++e){var a=c[e];var d=[];if(a.length==2){d.push(a[0]/b);d.push(a[1]/b);f.push(d);}else{d.push(a[0]);d.push(a[1]/b);d.push(a[2]/b);f.push(d);
}}return f;};var aP=function(g,c,f){var d=[];for(var b=0;b<g.length;++b){var a=g[b];var e=[];if(a.length==2){e.push(a[0]+c);e.push(a[1]+f);}else{e.push(a[0]);
e.push(a[1]+c);e.push(a[2]+f);}d.push(e);}return d;};var an=function(a){if(a==aQ){return;}if(aT){return;}aQ=a;switch(a){case Drawing.NORMAL:at(false);au.removeClass("hovered");
x(false);break;case Drawing.ACTIVE:at(true);au.removeClass("hovered");x(true);break;case Drawing.HOVER:au.addClass("hovered");if(!ah){x(true);}break;}};
al(aR);};Drawing.NORMAL=1;Drawing.ACTIVE=2;Drawing.HOVER=3;var Highlight=function(G,x,D,K,M,y,C,R,I,N){var H=this;if(arguments.length===10){this.id=G!=null?G:Utilities.generateUUID();
this.layer=x;this.content=D;this.x=K;this.y=M;this.pageNumber=y;this.color=C;this.author=R;this.rectangles=N;this.relatedAnnotation="";this.isReadOnly=I;
}else{this.id=Utilities.generateUUID();this.layer=null;this.content=null;this.x=-1;this.y=-1;this.pageNumber=-1;this.color=0;this.author=null;this.rectangles="[]";
this.relatedAnnotation="";this.isReadOnly=false;}this.type=AnnoTypes.HIGHLIGHT;var B=function(){L();};this.deleteSelf=function(){$(H).trigger("deleteRequested");
};this.destroy=function(){Q(false);for(var a=0;a<E.length;++a){E[a].detach();}};this.scale=function(){for(var a=0;a<E.length;++a){E[a].detach();}L();};
this.focus=function(a){if(AnnotationManager.activeAnnotation){AnnotationManager.activeAnnotation.defocus();}if(a){$(H).trigger("focused");}};this.defocus=function(a){if(AnnotationManager.activeAnnotation!==this){return;
}$("#ZoomSel").focus();};this.hide=function(){for(var a=0;a<E.length;++a){$(E[a]).hide();}F=false;};this.show=function(){for(var a=0;a<E.length;++a){$(E[a]).show();
}F=true;};this.isVisible=function(){return F;};this.getAnnoLocationInfo=function(){return U;};this.getLinePosition=function(){return[A.x1,A.y0+((A.y1-A.y0)/2)];
};this.setColor=function(a){if(a===H.color){return;}H.color=a;for(var b=0;b<E.length;++b){E[b].css("background-color",Utilities.intToColorString(H.color));
}$(H).trigger("annotationUpdated");};this.addRelatedAnnotation=function(a){if(H.relatedAnnotation!=""){return;}H.relatedAnnotation=a.id;};this.setHover=function(b){if(H.color==0){var d=b?0.1:0;
for(var c=0;c<E.length;++c){if($(E[c]).closest(".layer.highlight").length>0){$(E[c]).css({opacity:d});}}}else{var a=b?Utilities.intToColorString(Highlight.colorLookup[H.color].hoverColor):Utilities.intToColorString(H.color);
for(var c=0;c<E.length;++c){$(E[c]).css({"background-color":a});}}Q(b);};this.showContextMenu=function(a,b){var c={annotation:H,x:a,y:b};$(H).trigger("annotationContextMenu",[c]);
};var F=true;var E=[];var T,U,S,J;var A={x0:0,y0:1000000,x1:0,y1:1000000};var L=function(){var d=H.rectangles;for(var f=0;f<d.length;++f){var b=d[f];var c=$('<div class="hlrect normal"></div>');
E.push(c);T=b.x*DocumentManager.DRAWSCALE;U=b.y*DocumentManager.DRAWSCALE;S=b.width*DocumentManager.DRAWSCALE;J=b.height*DocumentManager.DRAWSCALE;c.appendTo(H.layer).css({"background-color":Utilities.intToColorString(H.color),top:U,left:T,width:S,height:J});
if(H.color==0){var e=$(H.layer).closest(".page-outer").find(".layer.strikeout");c.css({opacity:0});strikescaledY=U+(J/2)+(J*0.02);strikescaledH=J*0.1;var a=$('<div class="hlrect normal"></div>');
E.push(a);a.appendTo(e).css({"background-color":"#F00",top:strikescaledY,left:T,width:S,height:strikescaledH});a.show();}c.show();if(b.y<=A.y1&&b.x+b.width>=A.x1){A.x0=b.x;
A.y0=b.y;A.x1=b.x+b.width;A.y1=b.y+b.height;}}E[0].tipsy({html:true,voffset:2,hoffset:-10,gravity:"sw",title:P,trigger:"manual"});};var O=function(a){a.stopPropagation();
};var O=function(a){a.stopPropagation();};var P=function(){if(H.comment){return H.comment.getTooltipText();}return"";};var V=false;var Q=function(b){var a=(!V&&b)?"show":"hide";
E[0].tipsy(a);};B();};Highlight.colorLookup={16774792:{index:0,hoverColor:16765696,colorClass:"yellow",cursorClass:"hl_yellow_cursor"},16567402:{index:1,hoverColor:16755757,colorClass:"orange",cursorClass:"hl_orange_cursor"},12580500:{index:2,hoverColor:9695232,colorClass:"green",cursorClass:"hl_green_cursor"},10018303:{index:3,hoverColor:7524349,colorClass:"blue",cursorClass:"hl_blue_cursor"},0:{index:-1,hoverColor:0,colorClass:"",cursorClass:""}};
var Textbox=function(ao,aJ,aB,ah,ai,ay,av,aE,am,aC,az){var aD=this;if(arguments.length===11){this.id=ao!=null?ao:Utilities.generateUUID();this.layer=aJ;
this.content=aB;this.x=ah;this.y=ai;this.pageNumber=ay;this.color=av;this.size=aE;this.bgColor=am;this.author=aC;this.isReadOnly=az;}else{this.id=Utilities.generateUUID();
this.layer=null;this.content=null;this.x=-1;this.y=-1;this.pageNumber=-1;this.color=0;this.size=-1;this.bgColor=-1;this.author=null;this.isReadOnly=false;
}this.type=AnnoTypes.TEXTBOX;this.width=0;this.height=0;var aa=function(){W=aD.x*DocumentManager.DRAWSCALE;X=aD.y*DocumentManager.DRAWSCALE;ak=aD.size*DocumentManager.DRAWSCALE;
V();};this.deleteSelf=function(){$(aD).trigger("deleteRequested");};this.destroy=function(){if(!aD.isReadOnly){ar();clearTimeout(aj);}an.detach();an=aH=null;
an=aH=null;};this.scale=function(){var a=DocumentManager.DRAWSCALE;W=aD.x*a;X=aD.y*a;ak=aD.size*a;aI(W,X);};this.focus=function(a,b){if(AnnotationManager.activeAnnotation&&AnnotationManager.activeAnnotation!=this){AnnotationManager.activeAnnotation.defocus();
}if(aw!==Textbox.ACTIVE){ab(Textbox.ACTIVE);AnnotationManager.activeAnnotation=this;}if(a){al();}if(b){$(aD).trigger("focused");}};this.defocus=function(a){if(AnnotationManager.activeAnnotation!==this){return;
}if(aw===Textbox.ACTIVE){AnnotationManager.activeAnnotation=null;ab(Textbox.NORMAL);}var b=aM();if(b==""){if(a){$(aD).trigger("defocused");}$(this).trigger("deleteRequested");
}else{aH.blur();Utilities.clearSelection();if(a){$(aD).trigger("defocused");}}};this.hide=function(){if(an){an.hide();}};this.show=function(){if(an){an.show();
}};var ae=true;this.toggleUpdates=function(a){ae=a===true;};this.setContent=function(a){aD.content=a;var b=$.getMarkupText(aD.content,false);aH.html(b);
};this.setColor=function(a){ac();if(a===aD.color){return;}aD.color=a;an.css("color",Utilities.intToColorString(aD.color));if(ae){$(aD).trigger("annotationUpdated");
}};this.setPosition=function(b,a){aD.x=b;aD.y=a;aD.scale();};this.setSize=function(a){ac();if(a===aD.size){return;}aD.size=a;ak=aD.size*DocumentManager.DRAWSCALE;
an.css("fontSize",ak);aD.width=an.width()/DocumentManager.DRAWSCALE;aD.height=an.height()/DocumentManager.DRAWSCALE;if(ae){$(aD).trigger("annotationUpdated");
}};this.setBGColor=function(a){ac();if(a===aD.bgColor){return;}aD.bgColor=a;if(aD.bgColor!==-1){an.css({backgroundColor:"#FFFFFF"});}else{an.css({backgroundColor:""});
}if(ae){$(aD).trigger("annotationUpdated");}};this.getAnnoLocationInfo=function(){return X;};var aA,aK,aL;var ap,aq;var ad=false;var W,X,ak;var V=function(){if(an||aH){aD.destroy();
}var a=$.getMarkupText(aD.content,false);an=$('<div class="textbox normal"><div class="textbox-inner" spellcheck="false">'+a+"</div></div>");aH=an.find(".textbox-inner");
an.appendTo(aD.layer).css({color:Utilities.intToColorString(aD.color),fontSize:ak});an.css({top:X,left:W});an.show();if(aD.bgColor!==-1){an.css({backgroundColor:"#FFFFFF"});
}if(!aD.isReadOnly){ag();}};var al=function(){aH.attr("contentEditable",true);var a=aH[0];if(a.firstChild){Utilities.setSelection(a,true);}aH.focus();an.toggleClass("editmode",true);
};var ac=function(){if(an.hasClass("editmode")){al();}};var aI=function(b,a){an.css({fontSize:ak});an.css({top:a,left:b});};var ag=function(){an.bind("mousedown",Y).bind("mouseup",x).bind("mouseenter",ax).bind("mouseleave",at).bind("contextmenu",au);
aH.bind("blur keyup paste",y).bind("keypress",Utilities.onKeyPressed);};var ar=function(){an.unbind("mousedown",Y).unbind("mouseup",x).unbind("mouseenter",ax).unbind("mouseleave",at).unbind("contextmenu",au);
aH.unbind("blur keyup paste",y).unbind("keypress",Utilities.onKeyPressed);};var aG=function(b){if(!ad){$(aD).trigger("dragStarted");an.addClass("dragging");
ad=true;}var c=b.pageX-aA.left;var a=b.pageY-aA.top;ap=c-aK;aq=a-aL;aI(ap,aq);};var au=function(a){a.stopPropagation();return false;};var Y=function(b){if(b.button==2||b.metaKey===true){var c={annotation:aD,x:b.pageX,y:b.pageY};
$(aD).trigger("annotationContextMenu",[c]);}else{if(aw==Textbox.ACTIVE&&an.hasClass("editmode")&&b.target!==b.currentTarget){}else{aA=aD.layer.offset();
aK=(b.pageX-aA.left)-W;aL=(b.pageY-aA.top)-X;ad=false;$("#Doc").bind("mousemove",aG).bind("mouseup",x);var a=an.closest(".layer.anno");a.removeClass("drag_cursor_open").addClass("drag_cursor_close");
}}b.stopPropagation();};var x=function(b){if(b.button==2||b.metaKey===true){}else{$("#Doc").unbind("mousemove",aG).unbind("mouseup",x);if(ad){ad=false;
W=ap;X=aq;aD.x=W/DocumentManager.DRAWSCALE;aD.y=X/DocumentManager.DRAWSCALE;$(this).removeClass("dragging");$(aD).trigger("dragStopped");$(aD).trigger("annotationUpdated");
ac();}else{if(!AnnotationManager.isDragging){aD.focus(false,true);if($(b.target).closest(".textbox-inner").length>0&&!an.hasClass("editmode")){al();}}}}var a=an.closest(".layer.anno");
a.removeClass("drag_cursor_close").addClass("drag_cursor_open");b.stopPropagation();};var ax=function(b){if(aw==Textbox.ACTIVE){}else{if(!AnnotationManager.isDragging){ab(Textbox.HOVER);
}}var a=an.closest(".layer.anno");a.addClass("drag_cursor_open");};var at=function(b){if(aw==Textbox.ACTIVE){}else{if(!AnnotationManager.isDragging){ab(Textbox.NORMAL);
}}var a=an.closest(".layer.anno");a.removeClass("drag_cursor_open");};var y=function(a){clearTimeout(aj);aj=setTimeout(Z,500);};var aF=function(a){switch(a.keyCode){case 46:if(!aH.attr("contenteditable")){aD.deleteSelf();
}break;}};var an,aH;var aw=Textbox.NORMAL;var aM=function(){var a=$.trim(aH.getPreText());return a?a.replace(/\u200B/g,""):a;};var aj;var Z=function(){var a=aM();
if(aD.content!=a){aD.content=a.escapeHTML();aD.width=an.width()/DocumentManager.DRAWSCALE;aD.height=an.height()/DocumentManager.DRAWSCALE;$(aD).trigger("annotationUpdated");
}};var af=function(a){if(a){$(window).bind("keydown",aF);}else{$(window).unbind("keydown",aF);}};var ab=function(a){if(a==aw){return;}if(ad){return;}aw=a;
switch(a){case Textbox.NORMAL:an.removeClass("focused").removeClass("hovered").addClass("normal");aH.removeAttr("contenteditable");an.removeClass("editmode");
af(false);break;case Textbox.HOVER:an.addClass("hovered");break;case Textbox.ACTIVE:an.removeClass("normal").addClass("focused");af(true);break;}};aa();
};Textbox.NORMAL=1;Textbox.ACTIVE=2;Textbox.HOVER=3;var AnnotationPanel=function(){var O=this;this.setAnnotations=function(b,a){H(b,a);};this.updateAnnotation=function(a){U(a);
};this.deleteAnnotation=function(a){K(a);};this.updateAnnotations=function(a,b){X(a,b);};this.updateComment=function(a){E(a);};this.deleteComment=function(a){P(a);
};this.updateComments=function(a,b){C(a,b);};this.setKnownAuthors=function(a){F(a);};this.updateAuthorInfo=function(a){G(a);};this.handleAuthorHoverChange=function(b,a){aa(b,a);
};this.handleCheckedAuthorListChange=function(a){V(a);};var N={};var I={};var ac={};var T={};var M="page";var J=$(".groups-list").get(0);var W=$(".group-template").removeClass("group-template").remove().show().get(0);
var Z=$(".annotation-template").removeClass("annotation-template").remove().show().get(0);var H=function(b,a){ac=$.extend(true,{},b);T=$.extend(true,{},a);
L();};var U=function(l){ac[l.id]=$.extend(true,{},l);if(I[l.author]){return;}var a=D();var h=null;var c=null;var j=null;for(var k=0;k<a.length;k++){var d=a[k];
for(var g=0;g<d.annotations.length;g++){if(d.annotations[g].id==l.id){h=d;c=k;j=g;break;}}if(h){break;}}if(h){var i=$("#Group-"+h.id).get(0);if(!i){i=R(h);
if(c==0){$(i).prependTo(J);}else{var e=$(".group:eq("+(c-1)+")",J).get(0);$(i).insertAfter(e);}}$("#Annotation-"+l.id).remove();var f=$(".annotations-list",i).get(0);
var b=ad(l);if(j==0){$(b).prependTo(f);}else{var e=$(".annotation:eq("+(j-1)+")",f).get(0);$(b).insertAfter(e);}}};var K=function(a){var c=ac[a];delete ac[a];
if(c&&I[c.author]){return;}var d=$("#Annotation-"+a).get(0);var b=$(d).closest(".group").get(0);$(d).remove();if($(b).find(".annotation").length==0){$(b).remove();
}};var X=function(b,c){for(var a=0;a<b.length;a++){U(b[a]);}for(var a=0;a<c.length;a++){K(c[a].id);}};var E=function(a){T[a.id]=a;if(ac[a.annoId]){var b=ac[a.annoId];
U(b);}};var P=function(a){var b=T[a];if(b){delete T[a];if(ac[b.annoId]){var c=ac[b.annoId];U(c);}}};var C=function(b,c){for(var a=0;a<b.length;a++){E(b[a]);
}for(var a=0;a<c.length;a++){P(c[a].id);}};var F=function(a){N=$.extend(true,{},a);};var G=function(a){N[a.authorId]=$.extend(true,{},a);L();};var aa=function(c,b){for(var a in ac){var d=ac[a];
if(d.author==c){if(b){$("#Annotation-"+d.id).addClass("hover");}else{$("#Annotation-"+d.id).removeClass("hover");}}}};var V=function(a){var b={};for(var d=0;
d<a.length;d++){b[a[d]]=true;}I={};for(var c in N){if(!b[c]){I[c]=true;}}L();};var L=function(){var d=D();$(J).empty();for(var c=0;c<d.length;c++){var a=d[c];
var b=R(a);$(b).appendTo(J);}};var D=function(){var g={};for(var f in ac){var h=ac[f];if(I[h.author]){continue;}var c=(M=="page")?h.pageNumber:h.author;
var b=g[c];if(!b){if(M=="page"){var a="Page "+h.pageNumber;}else{var a=N[h.author].name||"anonymous";}b={id:c,header:a,annotations:[]};g[c]=b;}b.annotations.push(h);
}var d=[];$.each(g,function(){d.push(this);});g=d;g.sort(function(i,j){if(M=="page"){return i.id-j.id;}else{var k=(i.header!="anonymous")?i.header:"zzzzzzzzzzz";
var l=(j.header!="anonymous")?j.header:"zzzzzzzzzzz";if(k.toLowerCase()>l.toLowerCase()){return 1;}else{if(k.toLowerCase()<l.toLowerCase()){return -1;}else{return 0;
}}}});for(var e=0;e<g.length;e++){var b=g[e];b.annotations.sort(function(i,j){if(i.pageNumber!=j.pageNumber){return i.pageNumber-j.pageNumber;}else{return i.y-j.y;
}});}return g;};var R=function(b){var a=$(W).clone().attr("id","Group-"+b.id);a.find(".group-header").html(b.header);var c=a.find(".annotations-list").get(0);
for(var d=0;d<b.annotations.length;d++){var e=b.annotations[d];var f=ad(e);$(f).appendTo(c);}return a;};var ad=function(b){var a=$(Z).clone().attr("id","Annotation-"+b.id);
var e="",d="";if(b.type===AnnoTypes.STICKYNOTE){e=b.content===""?"(Blank note)":b.content;d="note-"+b.color;}else{if(b.type===AnnoTypes.HIGHLIGHT){e=b.content;
var f=Highlight.colorLookup[b.color].index;d=b.color===0?"strikeout":"highlight highlight-"+f;}else{if(b.type===AnnoTypes.TEXTBOX){e=b.content;d="ap-textbox";
}else{if(b.type===AnnoTypes.DRAWING){e="(Drawing)";d="drawing";}else{if(b.type===AnnoTypes.ANCHOR){e=null;d="anchor";}else{if(b.type===AnnoTypes.AREA){e=null;
d="area";}}}}}}var i=null;for(var g in T){var h=T[g];if(h.annoId==b.id){d+=" ap-comment";if(b.type==AnnoTypes.HIGHLIGHT){i=h.content;}else{e=h.content;
}}}var k=N[b.author]||{};if(M=="page"){var c=k&&k.name&&k.name!=""?k.name:"anonymous";}else{var c="Page "+b.pageNumber;}a.find(".name").html(c+" - ");if(e){a.find(".content").html(e);
}else{a.find(".content").html('<i style="color:Gray;">blank</i>');}if(i&&$.trim(i)!=""){a.find(".sub-content").text(i).show();}a.data("className",d).data("annotation",b).addClass(d);
var j=null;if(!b.lastModified||typeof(b.lastModified)=="undefined"){j=S(new Date());}else{j=S(Q(b.lastModified));}a.find(".date").text("Modified "+Y(j));
return a.get(0);};function Y(a){var c=new Date((a||"").replace(/-/g,"/").replace(/[TZ]/g," ")),b=(((new Date()).getTime()-c.getTime())/1000),d=Math.floor(b/86400);
if(isNaN(d)||d<0){return"just now";}return d==0&&(b<86400&&"today")||d==1&&"yesterday"||d<365&&c.format("mmmm dS")||c.format("mmmm dS, yyyy");}function Q(d){var c=d.match(/\d+/g),f=c[0],g=c[1],e=c[2],h=c[3],i=c[4],b=c[5];
var a=new Date(Date.UTC(f,g-1,e,h,i,b));return a;}function S(e){var c=e.getFullYear(),b=e.getMonth()+1,f=e.getDate(),g=e.getHours(),a=e.getMinutes(),d=e.getSeconds();
return c+"-"+b+"-"+f+"T"+g+":"+a+":"+d;}var ab=function(){$(".annotation").live("click",function(a){var b=$(this).data("annotation");$(O).trigger("annotationClick",[b.id]);
});$("#GroupByButton").live("click",function(){if($("#GroupByMenu:hidden").length>0){$("#GroupByMenu").show();}else{$("#GroupByMenu").hide();}return false;
});$("body").live("click",function(){$("#GroupByMenu").hide();});$("#GroupByMenu .item").live("click",function(){var b=$(this).attr("value");var a=$(this).text();
$("#GroupByButton").text(a);if(M!=b){M=b;L();}});};ab();};var AuthorPanel=function(q){var o=this;this.enable=function(){};this.setActiveAuthorInfo=function(a){v(a);
};this.updateAuthorInfo=function(a){p(a);};this.setKnownAuthors=function(b){for(authId in b){var a=b[authId];p(a);}};this.loginRequestedCallback=function(a){loginRequestedCallback(a);
};this.flash=function(){if(r){if($(document.body).hasClass("hide-sidebar")){var b='<div class="tipsyCustomArrow"></div><b>Tip:</b> Click button to<br/> view your annotations';
$("#OpenSidebarButton").tipsy({trigger:"manual",fade:true,gravity:"nw",voffset:3,hoffset:-178,html:true,className:"authorTip",fallback:b});$("#OpenSidebarButton").tipsy("show");
$(".authorTip").live("click",function(){$("#OpenSidebarButton").tipsy("hide");});$("#OpenSidebarButton").live("click",function(){$("#OpenSidebarButton").tipsy("hide");
});}else{var a=$("#CollaboratorOnboardingPanel");if($.browser.msie){a.show();}else{$("#CollaboratorOnboardingPanel").show("slide",{direction:"up"},500);
}}}};var r=false;var t=null;var u=null;var s=null;var x=$(".authors-box").get(0);var y=$(".author-list").get(0);var z=$(".author-template").removeClass("author-template").remove().get(0);
var v=function(a){if(!q.readonly){s=a.name;t=a.authorId;$(".author-top-box").find(".author-checkbox").attr("id",t);$(".author-top-box").data("author",a);
u=a.email;if(s){$("#AuthorName").val(s.unescapeHTML());$("#AuthorName").removeClass("watermark");}else{}if(u){$("#SettingsLink").text("Change notification settings");
}}};var p=function(b){var d=b.authorId;if(d==t){return;}var g=$("#Author-"+d);var a=true;if(g.get(0)){g.find(".additional-author-name").removeClass("empty");
}else{g=$(z).clone().attr("id","Author-"+d).show().appendTo(y);$(".author-checkbox",g).attr("id",d);a=false;}var i="anonymous";if(b.name&&b.name!=""){i=b.name;
g.find(".additional-author-name").removeClass("empty");}else{g.find(".additional-author-name").addClass("empty");}g.find(".additional-author-name").html(i);
g.data("author",b);if(b.state==1){g.find(".additional-author-name").addClass("online");}else{if(b.state==0){g.find(".additional-author-name").removeClass("online");
if(b.contributed==false){$("#Author-"+d).remove();}}}var h=$(x).outerHeight();var f=x?x.scrollHeight:0;if(f>h){var c=$("#TopPane").height();if(c<200){var e=c+(f-h);
if(e>200){e=200;}$("#RightPane").trigger("resize",[e]);}}};var n=function(){var c=$(".author-checkbox:checked");var e=[];for(var d=0;d<c.length;d++){var a=c[d].id;
e.push(a);}var b={authorIdList:e};$(o).trigger("checkedAuthorListChange",[b]);};var w=function(){if(!q.readonly){var c="Enter your name";$("#AuthorName").watermark(c);
var a=function(d){var e=d;if(!e){var f=$("#AuthorName").val();f=f.escapeHTML();if(f==c){f=null;}if(f==s){return;}s=f;e={name:s,email:u};}$(o).trigger("authorInfoChange",[e]);
};$("#AuthorName").click(function(){}).focus(function(){var d=$(this);if(!d.hasClass("focus-field")){setTimeout(function(){d.select();},0);}d.removeClass("idle-field").addClass("focus-field");
}).blur(function(){$(this).removeClass("focus-field").addClass("idle-field");a();}).keypress(function(d){if(d.keyCode==13){$(this).blur();}});$(window).unload(function(){$(o).trigger("authorLeave");
});$("#InviteAuthorsButton").click(function(){$(o).trigger("sharingButtonClick");if(!DEBUG){_gaq.push(["_trackEvent","sidebar-sharing","invite-btn-clicked"]);
}});$(".email-notification-dialog .close-x, .email-notification-dialog .close-button").click(function(){$(".email-notification-dialog").hide();});$(".author-email").keypress(function(d){if(d.which==13){$(".submit-email").click();
}});$(".submit-email").click(function(){var d=$(".author-email").val();if(d!=""){if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(d)){alert("invalid email address");
}else{$(".email-notification-dialog .panel").hide();$(".email-notification-dialog .email-conf-panel").show();u=$.trim(d);$("#SettingsLink").text("Change notification settings");
a();}}});}$(".additional-author").live("hover",function(d){var e=$(this).data("author");var f=d.type=="mouseover";if(e.contributed){$(o).trigger("authorHoverChange",[e.authorId,f]);
}});$(".author-top-box").live("hover",function(d){var e=$(this).data("author");var f=d.type=="mouseover";if(e&&e.contributed){$(o).trigger("authorHoverChange",[e.authorId,f]);
}});$(".additional-author .inner").live("mouseup",function(d){$("input[type=checkbox]",this).click();});$("input[type='checkbox']").attr("checked","true");
$("input[type='checkbox']").live("click",function(){setTimeout(n,0);});$("input[type='checkbox']").live("mouseup",function(){return false;});var b=function(){$(".onboarding-panel input.error").removeClass("error");
var d=$.trim($("#OnboardingNameInput").val());if(d==""){$("#OnboardingNameInput").addClass("error").focus();return false;}return{name:d,email:""};};if(!q.readonly&&!IS_AUTHENTICATED&&!IS_DEMO&&INITIAL_AUTHOR_INFO.name==null&&!SHOW_OWNER_ONBOARDING){r=true;
$(document).ready(function(){});$("#OnboardingNameInput").watermark("anonymous");$("#OnboardingLoginLink").click(function(){$(".onboarding-panel").hide();
$("#CollaboratorOnboardingPanel").hide();var d=location.pathname+location.search;location.href="/accounts/login/?next="+d;});$("#SetNameButton").mousedown(function(){$(this).addClass("active");
$(document).one("mouseup",function(){$("#SetNameButton").removeClass("active");});});$("#SetNameButton").click(function(){var d=b();if(d){v({authorId:t,name:d.name});
a(d);var e=$("#CollaboratorOnboardingPanel");if($.browser.msie){e.hide();}else{$("#CollaboratorOnboardingPanel").hide("slide",{direction:"up"},500);}if(!DEBUG){_gaq.push(["_trackEvent","sidebar-onboarding","info-added",((email)?"has-email":"no-email")]);
}}});$("#OnboardingNameInput").keypress(function(d){if(d.which==13){$("#SetNameButton").click();}});}};w();};var AnnoTypes={ANNOTATIONINFO:100,HIGHLIGHT:0,TEXTBOX:2,DRAWING:3,ANCHOR:4,AREA:5};
var EqualityFields={};var AnnotationInfo=function(j,l,n,h,i,k,m){if(arguments.length===7){this.id=j;this.content=l;this.color=n;this.pageNumber=h;this.x=i;
this.y=k;this.author=m;}else{this.id=Utilities.generateUUID();this.content=null;this.color=0;this.pageNumber=-1;this.x=-1;this.y=-1;this.author=null;}this.equals=function(c){if(!c){return false;
}for(var a=0;a<EqualityFields.baseEqualityFields.length;a++){var b=EqualityFields.baseEqualityFields[a];if(this[b]!==c[b]){return false;}}for(var a=0;a<EqualityFields[this.type].length;
a++){var b=EqualityFields[this.type][a];if(this[b]!==c[b]){return false;}}return true;};this.transform=function(b){var a=b=="unescape"?String.prototype.unescapeHTML:String.prototype.escapeHTML;
this.content=a.apply(this.content);};this.type=AnnoTypes.ANNOTATIONINFO;};EqualityFields.baseEqualityFields=["type","id","content","color","x","y","pageNumber"];
EqualityFields[AnnoTypes.ANNOTATIONINFO]=[];var HighlightInfo=function(r,n,q,l,k,m,p,o,j){if(arguments.length===9){AnnotationInfo.apply(this,[r,n,q,l,k,m,p]);
this.rectangles=o;this.relatedAnnotation=j;}else{AnnotationInfo.apply(this,[]);this.rectangles=null;this.relatedAnnotation=null;}this.type=AnnoTypes.HIGHLIGHT;
};EqualityFields[AnnoTypes.HIGHLIGHT]=["relatedAnnotation"];HighlightInfo.makeFromObject=function(c){var d=new HighlightInfo(c.id,c.content,c.color,c.pageNumber,c.x,c.y,c.author,c.rectangles,c.relatedAnnotation);
return d;};var DrawingInfo=function(j,n,i,k,h,m,l){if(arguments.length===7){AnnotationInfo.apply(this,[j,"",m,n,i,k,l]);this.lines=h;}else{AnnotationInfo.apply(this,[]);
this.lines=null;}this.type=AnnoTypes.DRAWING;};EqualityFields[AnnoTypes.DRAWING]=["lines"];DrawingInfo.makeFromObject=function(c){var d=new DrawingInfo(c.id,c.pageNumber,c.x,c.y,c.lines,c.color,c.author);
return d;};var AnchorInfo=function(h,f,g,i,j){if(arguments.length===5){AnnotationInfo.apply(this,[h,"",0,f,g,i,j]);}else{AnnotationInfo.apply(this,[]);
}this.type=AnnoTypes.ANCHOR;};EqualityFields[AnnoTypes.ANCHOR]=[];AnchorInfo.makeFromObject=function(c){var d=new AnchorInfo(c.id,c.pageNumber,c.x,c.y,c.author);
return d;};var AreaInfo=function(j,n,h,k,l,i,m){if(arguments.length===7){AnnotationInfo.apply(this,[j,"",0,n,h,k,m]);this.width=l;this.height=i;}else{AnnotationInfo.apply(this,[]);
this.width=-1;this.height=-1;}this.type=AnnoTypes.AREA;};EqualityFields[AnnoTypes.AREA]=["width","height"];AreaInfo.makeFromObject=function(c){var d=new AreaInfo(c.id,c.pageNumber,c.x,c.y,c.width,c.height,c.author);
return d;};var TextboxInfo=function(v,r,n,q,o,u,m,t,l,p,s){if(arguments.length===11){AnnotationInfo.apply(this,[v,r,t,o,n,q,s]);this.width=u;this.height=m;
this.size=l;this.bgColor=p;}else{AnnotationInfo.apply(this,[]);this.width=-1;this.height=-1;this.size=-1;this.bgColor=-1;}this.type=AnnoTypes.TEXTBOX;};
EqualityFields[AnnoTypes.TEXTBOX]=["width","height","size","bgColor"];TextboxInfo.makeFromObject=function(c){var d=new TextboxInfo(c.id,c.content,c.x,c.y,c.pageNumber,c.width,c.height,c.color,c.size,c.bgColor,c.author);
return d;};var CommentInfo=function(i,k,h,j,g,l){if(arguments.length===6){this.id=i;this.content=k;this.annoId=h;this.annoType=j;this.orderIndex=g;this.author=l;
}else{this.id=null;this.content="";this.annoId=null;this.annoType=-1;this.orderIndex=0;this.author=null;}this.equals=function(c){if(!c){return false;}for(var a=0;
a<CommentInfo.EQUALITY_FIELDS.length;a++){var b=CommentInfo.EQUALITY_FIELDS[a];if(this[b]!==c[b]){return false;}}return true;};this.transform=function(b){var a=b=="unescape"?String.prototype.unescapeHTML:String.prototype.escapeHTML;
this.content=a.apply(this.content);};};CommentInfo.EQUALITY_FIELDS=["id","content","annoId","orderIndex","author"];CommentInfo.makeFromObject=function(d){var c=new CommentInfo(d.id,d.content,d.annoId,d.annoType,d.orderIndex,d.author);
return c;};var DocTitle=function(j,i){var f=this;var g=function(){h=j;if(!i){$("#HeaderTitle").bind("mousedown",function(){$(this).addClass("active").attr("contenteditable","true");
}).bind("blur",function(){$(this).removeClass("active").removeAttr("contenteditable");var a=$(this).text().escapeHTML();$(this).detach().insertAfter(".logo");
if(a==""){$(this).text(h);}else{if(a!=h){h=a;document.title=h.unescapeHTML()+" | Crocodoc";$(f).trigger("titleUpdated",[h]);}}}).bind("keypress",function(a){if(a.which==13){$(this).blur();
}else{if(a.which==60||a.which==62){return false;}}});}};var h=null;g();};var Model=function(){var o=this;var p=function(){};var q=null;var w={};var v={};
var y=null;this.startTime=new Date();this.lastModified=null;var s=null;var A=null;this.getExportPermissions=function(a){$.post("/user/getExportPermissions",{},function(d){var c="";
var b=false;if(d=="true"){b=true;}else{c=d;}if(typeof a=="function"){a(b,c);}});};var t=["tut","annoTbShowing","tbColor","tbSize","tbBGColor","drColor","hlColor","sidePanelShown"];
this.getUserPrefs=function(){var c={};for(var b in t){var d=t[b];var a=$.cookie(d);if(a){a=parseInt(a);}c[d]=a;}return c;};this.updateUserPref=function(b,a){$.cookie(b,a.toString(),{expires:730});
};var r={};var u={};this.getKnownAuthors=function(){return Utilities.clone(u,true);};this.getCurrentAuthorInfo=function(){return Utilities.clone(r,true);
};this.setAuthorInfo=function(c,a,b){r=c;u[r.authorId]=r;if(!b){x(a);}};this.setAuthorInactive=function(){r.state=0;x(null,true);};var x=function(a,f){f=f||false;
if(typeof(a)!=="function"){a=function(){};}if(IS_DEMO){setTimeout(function(){a();},0);return;}if(r.authorId){var e=Utilities.clone(r,true);e.name=e.name?e.name.unescapeHTML():e.name;
var b=$.query.get("countview")=="false";var d=JSON.stringify(e);var c={author:d,smode:b,shortId:q.shortId};if(f&&o.lastModified){if(!s||s<o.lastModified){c.triggeremail=true;
}}$.ajax({url:"/webservice/author/save",type:"POST",async:!f,contentType:"application/json; charset=utf-8",data:c,dataType:"json",success:function(g){a(g);
},error:function(g,i,h){a(h);}});}};var B={};this.loadDocument=function(b,a){if(typeof(a)!=="function"){a=function(){};}q=b;r.document=q.uuid;var c=function(k,e){y=k.now;
var d=JSON.parse(k.authors);var l=JSON.parse(k.annos);var i=JSON.parse(k.comments);for(var h=0;h<d.length;h++){var j=d[h].fields;j.name=j.name?j.name.escapeHTML():j.name;
B[d[h].pk]=j.authorId;u[j.authorId]=j;}for(var h=0;h<l.length;++h){var f=l[h].fields;f.id=l[h].pk;if(f.author){f.author=B[f.author];}switch(f.type){case AnnoTypes.HIGHLIGHT:f=HighlightInfo.makeFromObject(f);
break;case AnnoTypes.TEXTBOX:f=TextboxInfo.makeFromObject(f);break;case AnnoTypes.DRAWING:f=DrawingInfo.makeFromObject(f);break;case AnnoTypes.ANCHOR:f=AnchorInfo.makeFromObject(f);
break;case AnnoTypes.AREA:f=AreaInfo.makeFromObject(f);break;default:continue;}f.transform("escape");w[f.id]=f;}for(var h=0;h<i.length;++h){var g=i[h].fields;
g.id=i[h].pk;g=CommentInfo.makeFromObject(g);g.transform("escape");v[g.id]=g;if(g.author){g.author=B[g.author];}}e();};if(DOCUMENT_GET){setTimeout(function(){c(DOCUMENT_GET,a);
},10);}else{$.ajax({url:"/webservice/document/get",type:"GET",cache:false,data:"uuid="+q.uuid+"&shortId="+q.shortId,dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){c(d,a);
},error:function(d,f,e){a(e);}});}};this.refreshDocument=function(b,a){if(typeof(a)!=="function"){a=function(){};}if(IS_DEMO){setTimeout(function(){a([],[],[],[],[]);
},0);return;}var c=function(k,H){if(!k||typeof(k)=="string"){H("Error in refreshDocument callback, response was: "+k);return;}y=k.now;var e=JSON.parse(k.authors);
var J=JSON.parse(k.annos);var i=JSON.parse(k.comments);var g=[],l=[],L=[];var m=(new Date()).getTime();for(var h=0;h<e.length;h++){var j=e[h].fields;j.name=j.name?j.name.escapeHTML():j.name;
var n=u[j.authorId];if(n&&n.name==j.name&&n.state==j.state&&n.contributed==j.contributed){continue;}B[e[h].pk]=j.authorId;u[j.authorId]=j;L[L.length]=j;
}for(var h=0;h<J.length;++h){var K=J[h].fields;K.id=J[h].pk;if(K.author){K.author=B[K.author];}if(K.deleted){w[K.id]=null;delete w[K.id];l[l.length]=K;
}else{switch(K.type){case AnnoTypes.HIGHLIGHT:K=HighlightInfo.makeFromObject(K);break;case AnnoTypes.TEXTBOX:K=TextboxInfo.makeFromObject(K);break;case AnnoTypes.DRAWING:K=DrawingInfo.makeFromObject(K);
break;case AnnoTypes.ANCHOR:K=AnchorInfo.makeFromObject(K);break;case AnnoTypes.AREA:K=AreaInfo.makeFromObject(K);break;}K.transform("escape");var n=w[K.id];
if(n){if(n.author==o.getCurrentAuthorInfo().authorId||n.lastSaved&&(m-n.lastSaved)<5000){continue;}if(K.equals(n)){continue;}}g[g.length]=w[K.id]=K;}}var d=[];
var I=[];for(var h=0;h<i.length;++h){var f=i[h].fields;f.id=i[h].pk;if(f.deleted){v[f.id]=null;delete v[f.id];I[I.length]=f;}else{var n=v[f.id];f=CommentInfo.makeFromObject(f);
f.transform("escape");if(n){if(n.author==o.getCurrentAuthorInfo().authorId||n.lastSaved&&(m-n.lastSaved)<5000){continue;}if(f.equals(n)){continue;}}if(f.author){f.author=B[f.author];
}d[d.length]=v[f.id]=f;}}H(null,g,l,L,d,I);};$.ajax({url:"/webservice/document/refresh",type:"POST",data:{uuid:q.uuid,shortId:q.shortId,loadTime:y},dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){c(d,a);
},error:function(d,f,e){a(e);}});};this.getDocument=function(){if(q){return Utilities.clone(q,true);}return null;};this.setTitle=function(b,a){if(IS_DEMO){setTimeout(function(){a();
},0);return;}if(q){q.title=b;b=b.unescapeHTML();$.ajax({url:"/webservice/document/rename",type:"POST",data:{uuid:q.uuid,title:b},dataType:"json",contentType:"application/json; charset=utf-8",success:function(c){a();
},error:function(c,e,d){a(d);}});}};this.getAllComments=function(){return Utilities.clone(v,true);};this.getAnnotation=function(b){var a=w[b];return a?Utilities.clone(a,true):null;
};this.saveComment=function(b,a){if(typeof(a)!="function"){a=function(){};}if(IS_DEMO){setTimeout(function(){a();},0);return;}if(!b){return;}clearInterval(A);
A=setTimeout(z,1000*60*10);b.transform("unescape");var c=Utilities.clone(b,true);b.transform("escape");v[b.id]=b;o.lastModified=new Date();b.lastSaved=o.lastModified.getTime();
c.document=q.uuid;var d=JSON.stringify(c);$.ajax({url:"/webservice/comment/save",type:"POST",contentType:"application/json; charset=utf-8",data:{comment:d,shortId:q.shortId},dataType:"json",success:function(e){a(e);
},error:function(e,g,f){a(f);}});};this.deleteComment=function(d,a,c){if(typeof(a)!=="function"){a=function(){};}if(IS_DEMO){setTimeout(function(){a();
},0);return;}var b=v[d];if(!b){a();return null;}v[d]=null;delete v[d];if(!c){o.lastModified=new Date();clearInterval(A);A=setTimeout(z,1000*60*10);if(typeof(a)!=="function"){a=function(){};
}$.ajax({url:"/webservice/comment/delete",type:"POST",data:"commentId="+d+"&shortId="+q.shortId,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){a(e);
},error:function(e,g,f){a(f);}});}};this.getAllAnnotations=function(){return Utilities.clone(w,true);};this.saveAnnotation=function(c,a){if(typeof(a)!=="function"){a=function(){};
}if(IS_DEMO){setTimeout(function(){a();},0);return;}if(!c){return;}clearInterval(A);A=setTimeout(z,1000*60*10);c.transform("unescape");var b=Utilities.clone(c,true);
c.transform("escape");w[c.id]=c;o.lastModified=new Date();c.lastSaved=o.lastModified.getTime();b.document=q.uuid;var d=JSON.stringify(b);$.ajax({url:"/webservice/annotation/save",type:"POST",contentType:"application/json; charset=utf-8",data:{anno:d,shortId:q.shortId},dataType:"json",success:function(e){a(e);
},error:function(e,g,f){a(f);}});};this.deleteAnnotation=function(d,a,b){if(typeof(a)!=="function"){a=function(){};}if(IS_DEMO){setTimeout(function(){a();
},0);return;}var c=w[d];if(!c){a();return null;}w[d]=null;delete w[d];if(!b){o.lastModified=new Date();clearInterval(A);A=setTimeout(z,1000*60*10);if(typeof(a)!=="function"){a=function(){};
}$.ajax({url:"/webservice/annotation/delete",type:"POST",data:{annoId:d,type:c.type,shortId:q.shortId},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){a(e);
},error:function(e,g,f){a(f);}});}return c.relatedAnnotation;};this.log=function(d,a){if(IS_DEMO){return;}var c={messageType:d,message:a};var b=JSON.stringify(c).replace("&","%26");
$.ajax({url:"/webservice/log/log",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:{msgObj:b}});};var z=function(){if(IS_DEMO){return;
}s=new Date();var b=JSON.stringify(r);var a="author="+encodeURIComponent(b);$.ajax({url:"/webservice/author/triggeremail",type:"POST",contentType:"application/json; charset=utf-8",data:a,dataType:"json",success:function(c){}});
};p();};var LogTypes={ERROR:0,INFO:1,DEBUG:2};var SidePanel=function(j){var g=this;var h=function(){if(j){f();}else{i();}$("#OpenSidebarButton").live("click",function(a){f();
});$(".sidebar-close").live("click",function(a){i();});};var f=function(){$(document.body).removeClass("hide-sidebar");var a=$(".authors-box");if(a.height()<a[0].scrollHeight){var b=a[0].scrollHeight-a.height();
var d=$("#TopPane").height();var c=Math.min(d+b,200);$("#TopPane").height(c);}$("#PageSplitter").trigger("resize");$(g).trigger("opened");};var i=function(){$(document.body).addClass("hide-sidebar");
$(g).trigger("closed");};h();};var Utilities={elementContainsPoint:function(n,i){var l,o,m,p,j,k;l=n.offset().left;o=l+n.width();m=n.offset().top;p=m+n.height();
j=i.x;k=i.y;if(j<=o&&j>=l){if(k<=p&&k>=m){return true;}}return false;},eventKiller:function(b){b.stopPropagation();b.preventDefault();return false;},clone:function(c,d){if(d){return $.extend(true,{},c);
}else{return $.extend({},c);}},isBrowserCompatible:function(){return true;},generateUUID:function(){function b(){return(((1+Math.random())*65536)|0).toString(16).substring(1);
}return(b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()).toUpperCase();},generateShortId:function(){function e(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
var b=Math.floor(Math.random()*62);return a.substr(b,1);}var f="";for(var d=0;d<7;d++){f+=e();}return f;},validateNumber:function(c){var d=window.event?c.keyCode:c.which;
if(c.keyCode==8||c.keyCode==46||c.keyCode==37||c.keyCode==39){return true;}else{if(d<48||d>57){return false;}else{return true;}}},setSelection:function(f,g){if(document.createRange){var e=document.createRange(),h=window.getSelection();
e.selectNodeContents(f);if(g){e.collapse(false);}h.removeAllRanges();h.addRange(e);}else{if(document.body.createTextRange){var e=document.body.createTextRange();
e.moveToElementText(f);if(g){e.collapse(false);}e.select();}}},clearSelection:function(){if(window.getSelection){window.getSelection().removeAllRanges();
}else{}},addSVGClasses:function(d,f){for(var e=0;e<f.length;e++){if(!Utilities.hasSVGClass(d,f[e])){if(typeof d.className.baseVal!="undefined"){d.className.baseVal+=" "+f[e];
}else{d.className+=" "+f[e];}}}},hasSVGClass:function(h,i){var g=false;var j;if(typeof h.className.baseVal!="undefined"){j=h.className.baseVal.split(" ");
}else{j=h.className.split(" ");}for(var f=0;f<j.length;f++){if(i==j[f]){g=true;}}return g;},removeSVGClass:function(k,l){var j=typeof k.className.baseVal!="undefined";
if(Utilities.hasSVGClass(k,l)){var g;if(j){g=k.className.baseVal.split(" ");}else{g=k.className.split(" ");}var i=[];for(var h=0;h<g.length;h++){if(!(l==g[h])){i.push(g[h]);
}}if(j){k.className.baseVal=i.join(" ");}else{k.className=i.join(" ");}}},intToColorString:function(f){if(typeof f!=="number"){return f;}var d="#000000";
var e=f.toString(16);return d.substring(0,7-e.length)+e;},validateEmailAddresses:function(n){var t=new RegExp("^\\w(?:\\w|-|\\.|\\+(?!\\.|@))*@\\w(?:\\w|-|\\.(?!\\.))*\\.\\w{2,3}");
var u=new RegExp('\\"?(.*?)\\"?\\s*?<\\s*(.*?)\\s*>');var q=n.split(",");var p="";for(var r=0;r<q.length;++r){var m=$.trim(q[r]);if(m==""){continue;}var i=false,v="",o="";
if(m.match(u)){var s=u.exec(m);v=s[1];o=s[2];if(o.match(t)){i=true;}}else{if(m.match(t)){o=m;i=true;}}if(!i){return false;}if(p!=""){p+=",";}p+=m;}return p;
},trima:function(b){return(b==null)?null:b.replace(/^\s+|\s+$/g,"");},ltrima:function(b){return(b==null)?null:b.replace(/^\s+/,"");},rtrima:function(b){return(b==null)?null:b.replace(/\s+$/,"");
},replaceNL:function(d,c){return(d==null)?null:d.replace(/[\n\r\t]/g,c);},onKeyPressed:function(b){if(b.which==13){if(window.getSelection&&window.getSelection().getRangeAt){}else{if(document.selection&&document.selection.createRange){document.selection.createRange().pasteHTML("<br>&#x200B;");
$(b.target).one("keypress",function(d){if(d.which==13){return;}var a=$(d.target);a.html(a.html().replace(/\u200B/g,""));});return false;}}}}};String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;");
};String.prototype.unescapeHTML=function(){return this.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/").replace(/&amp;/g,"&");
};$.fn.getPreText=function(){var c=$("<pre />").html(this.html());var d=this.css("display");if($.browser.webkit&&d!="inline"){c.find("div").replaceWith(function(){return"\n"+this.innerHTML;
});}if($.browser.msie){c.find("p").replaceWith(function(){return this.innerHTML+"<br>";});}if($.browser.mozilla||$.browser.opera||$.browser.msie||$.browser.webkit&&d=="inline"){if(c.find("br").length>0){c.find("br").replaceWith("\n");
}}return c.text();};$.getMarkupText=function(j,k){var h=j.split("\n");var n=h[0];if(h.length===1){return n;}var l;if($.browser.webkit&&!k){l=function(a){return a==""?"<div><br></div>":"<div>"+a+"</div>";
};}else{if(false&&$.browser.msie){l=function(a){return"<p>"+a+"</p>";};}else{l=function(a){return"<br>"+a;};}}h.shift();for(var m in h){var i=h[m];n+=l(i);
}return n;};(function(e,c,d){e.scrollbarWidth=function(){var b,a;if(d===c){b=e('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");
a=b.children();d=a.innerWidth()-a.height(99).innerWidth();b.remove();}return d;};})(jQuery);$.fn.textNodes=function(){var b=[];this.contents().each(function(){var a=arguments.callee;
if(this.nodeType==3){b.push(this);}else{$(this).contents().each(a);}});return $(b);};$.expr[":"].raph=function(i,c,j,g){var h=i.getAttribute("class");return(h&&h.indexOf(j[3])!=-1);
};var SharingDialog=function(m){var n=this;this.open=function(a){t=a;r();};this.setShareParameters=function(a){s=a;};var o=function(){p=$("#ShareDialog").dialog({autoOpen:false,modal:true,resizable:false,closeOnEscape:false,width:400});
p.find(".dialog-toggle").click(function(a){var b=this.getAttribute("id");if(u===b){return;}r(b);});p.find(".close").click(function(a){p.dialog("close");
});$("#ShareLinkInput,#ShareEmbedInput").bind("click focus",function(a){this.select();});$("#SendEmailBtn").click(function(){w();});p.find(".readonly-checkbox").change(function(a){v();
var b=$(this).closest(".panel").find(".url-to-copy");$(b).css("background-color","#FFFFCC");setTimeout(function(){$(b).css("background-color","#FFFFFF");
},250);});$("#ShareLinkPanel .readonly-checkbox").attr("checked",true);$("#ShareEmbedPanel .readonly-checkbox").removeAttr("checked");};var p=null;var u="ShareLink";
var t=null;var s=null;var r=function(b){b=b||u;p.find(".dialog-toggle").removeClass("active");$("#"+b).addClass("active");p.find(".panel").hide();var a=$("#"+b+"Panel");
a.show();setTimeout(function(){a.find(".first").focus();},0);u=b;x("SharingView");p.dialog("open");v();};var v=function(){var d=location.host;var e=null;
if(s.readonly){p.find(".readonly-checkbox").attr("disabled",true).removeAttr("checked");p.find(".readonly-checkbox").parent().addClass("disabled");}var c=function(f){if(f){var g=s.editId;
}else{if(s.readId){var g=s.readId;}else{var h=Utilities.generateShortId();s.readId=h;$.ajax({type:"POST",url:"/webservice/document/share",data:{uuid:m,shortId:s.editId,readId:h}});
var g=h;}}return g;};if($("#ShareLinkPanel").is(":visible")){e=c($("#ShareLinkPanel .readonly-checkbox").is(":checked"));var b="http://"+d+"/"+e;$("#ShareLinkInput").val(b);
}if($("#ShareEmbedPanel").is(":visible")){e=c($("#ShareEmbedPanel .readonly-checkbox").is(":checked"));var a='<iframe src="http://'+d+"/"+e+'?embedded=true" width="100%" height="600" style="border:1px solid #ddd;"></iframe>';
$("#ShareEmbedInput").val(a);}};var w=function(b){var a=Utilities.validateEmailAddresses($("#ShareEmailTo").val());if(a){var c=$("#ShareEmailMsg").val();
c=c.replace(new RegExp("\\r","g"),"\n");x("WaitView");p.find(".error-box").hide();q(a,c);}else{p.find(".error-box").text("Please verify that all email addresses are valid").show();
}};var q=function(a,b){var c=s.editId||s.readId;$.ajax({type:"POST",url:"/webservice/document/email",data:{uuid:m,shortId:c,recipients:a,message:b,authorId:t},success:function(){x("SuccessView");
},error:function(f,d,e){x("ErrorView");}});};var x=function(a){p.find(".view").hide();$("#"+a).show();};o();};